<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<div class="dead">
<pre class="code">
<span class="srcline"><span class="lineno"><a href="2,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">classdef</span> ybp_finder_CLS</span></span>
<span class="srcline"><span class="lineno"><a href="2,2" id="srcline2">  2</a></span><span class="line"><span class="comment">% YBP_FINDER_CLS find YELLOW,BLUE,PURPLE things</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%   contains algorithm for identifying the lane markings (blue, yellow)</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,4" id="srcline4">  4</a></span><span class="line"><span class="comment">%   and obstacles(purple) in a DRC image</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%-------------------------------------------------------------------------- </span></span></span>
<span class="srcline"><span class="lineno"><a href="2,6" id="srcline6">  6</a></span><span class="line"><span class="comment">% ATTENTION:</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%  1.) See the proof of concept script called &lt;bh_LabColorSegmentationExample_DRC.mlx&gt;</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%-------------------------------------------------------------------------- </span></span></span>
<span class="srcline"><span class="lineno"><a href="2,9" id="srcline9">  9</a></span><span class="line"><span class="comment">% EXAMPLE USAGE #1:</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------    </span></span></span>
<span class="srcline"><span class="lineno"><a href="2,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">% EXAMPLE USAGE #2:</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------   </span></span></span>
<span class="srcline"><span class="lineno"><a href="2,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">% Author:  bradley.horton@mathworks.com.au</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------   </span></span></span>
<span class="srcline"><span class="lineno"><a href="2,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">% History:</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">%  17-Nov-2017 : inspired by conversations and advice with Daryl</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------    </span></span></span>
<span class="srcline"><span class="lineno"><a href="2,18" id="srcline18"> 18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,19" id="srcline19"> 19</a></span><span class="line"><span class="keyword">properties</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,20" id="srcline20"> 20</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="2,21" id="srcline21"> 21</a></span><span class="line">    <span class="comment">%----------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,22" id="srcline22"> 22</a></span><span class="line">    <span class="comment">% performed well for a 480x640</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,23" id="srcline23"> 23</a></span><span class="line">    E_tgt_for_lane                = 0.8; <span class="comment">%0.97;  % eccentricity of pixel blobs</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,24" id="srcline24"> 24</a></span><span class="line">    A_tgt_for_lane                = 100;   <span class="comment">%20;    % area of pixel blobs</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,25" id="srcline25"> 25</a></span><span class="line">    fraction_of_img_to_ignore     = 0.4; <span class="comment">%0.5;   % fraction of TOP part of image</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,26" id="srcline26"> 26</a></span><span class="line">    <span class="comment">%----------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,27" id="srcline27"> 27</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------    </span></span></span>
<span class="srcline"><span class="lineno"><a href="2,29" id="srcline29"> 29</a></span><span class="line"><span class="keyword">properties</span> (SetAccess = protected)    </span></span>
<span class="srcline"><span class="lineno"><a href="2,30" id="srcline30"> 30</a></span><span class="line">    nColors                   = 5;</span></span>
<span class="srcline"><span class="lineno"><a href="2,31" id="srcline31"> 31</a></span><span class="line">    color_labels              = 0:4;</span></span>
<span class="srcline"><span class="lineno"><a href="2,32" id="srcline32"> 32</a></span><span class="line">    color_markers             = zeros([5, 2]);</span></span>
<span class="srcline"><span class="lineno"><a href="2,33" id="srcline33"> 33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,34" id="srcline34"> 34</a></span><span class="line">        DRC_image             = []; <span class="comment">% M_x_N_x_3</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,35" id="srcline35"> 35</a></span><span class="line">    lab_DRC_image             = []; <span class="comment">% M_x_N_x_3 </span></span></span>
<span class="srcline"><span class="lineno"><a href="2,36" id="srcline36"> 36</a></span><span class="line">    label                     = []; <span class="comment">% M_x_N</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,37" id="srcline37"> 37</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------    </span></span></span>
<span class="srcline"><span class="lineno"><a href="2,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">%_#########################################################################</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,40" id="srcline40"> 40</a></span><span class="line"><span class="keyword">methods</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,41" id="srcline41"> 41</a></span><span class="line"><span class="keyword">function</span> OBJ =  ybp_finder_CLS(marker_s, tf_do_plots)</span></span>
<span class="srcline"><span class="lineno"><a href="2,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">% ALLOWED usage:</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,43" id="srcline43"> 43</a></span><span class="line"><span class="comment">%  &gt;&gt; OBJ = ybp_finder_CLS(marker_s)</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,44" id="srcline44"> 44</a></span><span class="line"><span class="comment">%  &gt;&gt; OBJ = ybp_finder_CLS(marker_s, tf_do_plots)</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,45" id="srcline45"> 45</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,46" id="srcline46"> 46</a></span><span class="line">    <span class="keyword">if</span>(1==nargin)</span></span>
<span class="srcline"><span class="lineno"><a href="2,47" id="srcline47"> 47</a></span><span class="line">        tf_do_plots = false;</span></span>
<span class="srcline"><span class="lineno"><a href="2,48" id="srcline48"> 48</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,49" id="srcline49"> 49</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,50" id="srcline50"> 50</a></span><span class="line">   OBJ.nColors       =  marker_s.nColors;    </span></span>
<span class="srcline"><span class="lineno"><a href="2,51" id="srcline51"> 51</a></span><span class="line">   OBJ.color_labels  =  marker_s.color_labels;        </span></span>
<span class="srcline"><span class="lineno"><a href="2,52" id="srcline52"> 52</a></span><span class="line">   OBJ.color_markers =  marker_s.color_markers;         </span></span>
<span class="srcline"><span class="lineno"><a href="2,53" id="srcline53"> 53</a></span><span class="line">           </span></span>
<span class="srcline"><span class="lineno"><a href="2,54" id="srcline54"> 54</a></span><span class="line"><span class="keyword">end</span> <span class="comment">% ybp_finder_CLS</span></span></span>
</pre>
</div>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="2,55" id="srcline55"> 55</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------  </span></span></span>
<span class="srcline"><span class="lineno"><a href="2,56" id="srcline56"> 56</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S19T11U93">OBJ</span> = classify(<span class="var type1" id="S19T11U96">OBJ</span>, <span class="var type1" id="S20T7U97">DRC_image</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="2,57" id="srcline57"> 57</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,58" id="srcline58"> 58</a></span><span class="line">    <span class="mxinfo " id="T3:U4"><span class="var type1" id="S21T3U100">nColors</span>       = <span class="mxinfo " id="T3:U6"><span class="var type1" id="S19T11U102">OBJ</span>.nColors</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="2,59" id="srcline59"> 59</a></span><span class="line">    <span class="mxinfo " id="T9:U8"><span class="var type1" id="S22T9U106">color_labels</span>  = <span class="mxinfo " id="T9:U10"><span class="var type1" id="S19T11U108">OBJ</span>.color_labels</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="2,60" id="srcline60"> 60</a></span><span class="line">    <span class="mxinfo " id="T10:U12"><span class="var type1" id="S23T10U112">color_markers</span> = <span class="mxinfo " id="T10:U14"><span class="var type1" id="S19T11U114">OBJ</span>.color_markers</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="2,61" id="srcline61"> 61</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="2,62" id="srcline62"> 62</a></span><span class="line">    <span class="comment">% record initial size of the input image</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,63" id="srcline63"> 63</a></span><span class="line">    <span class="mxinfo " id="T3:U16"><span class="var type1" id="S24T3U118">NUM_ROWS</span> = <span class="mxinfo " id="T3:U18">size(<span class="var type1" id="S20T7U121">DRC_image</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="2,64" id="srcline64"> 64</a></span><span class="line">    <span class="mxinfo " id="T3:U20"><span class="var type1" id="S26T3U125">NUM_COLS</span> = <span class="mxinfo " id="T3:U22">size(<span class="var type1" id="S20T7U128">DRC_image</span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="2,65" id="srcline65"> 65</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="2,66" id="srcline66"> 66</a></span><span class="line">    <span class="comment">% so what row range to I really want to process</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,67" id="srcline67"> 67</a></span><span class="line">    <span class="mxinfo " id="T3:U24"><span class="var type1" id="S27T3U132">rmin</span>      = <span class="mxinfo " id="T3:U26">round(<span class="mxinfo " id="T3:U27"><span class="var type1" id="S24T3U136">NUM_ROWS</span>*<span class="mxinfo " id="T3:U29"><span class="var type1" id="S19T11U138">OBJ</span>.fraction_of_img_to_ignore</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="2,68" id="srcline68"> 68</a></span><span class="line">    <span class="mxinfo " id="T3:U31"><span class="var type1" id="S29T3U142">rmax</span>      = <span class="var type1" id="S24T3U143">NUM_ROWS</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="2,69" id="srcline69"> 69</a></span><span class="line">    <span class="mxinfo " id="T27:U34"><span class="var type1" id="S30T27U146">row_range</span> = <span class="mxinfo " id="T27:U36"><span class="var type1" id="S27T3U148">rmin</span>:<span class="var type1" id="S29T3U149">rmax</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="2,70" id="srcline70"> 70</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="2,71" id="srcline71"> 71</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="2,72" id="srcline72"> 72</a></span><span class="line">    <span class="comment">% Perform classification on NEW image</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,73" id="srcline73"> 73</a></span><span class="line">    <span class="mxinfo " id="T104:U39"><span class="var type1" id="S31T104U152">lab_DRC_image</span> = <span class="mxinfo " id="T104:U41"><span class="potentialdiff PD1">rgb2lab( <span class="mxinfo " id="T105:U42"><span class="var type1" id="S20T7U156">DRC_image</span>(<span class="var type1" id="S30T27U157">row_range</span>,<span class="mxinfo " id="T119:U45">:</span>,<span class="mxinfo " id="T106:U46">:</span>)</span> )</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="2,74" id="srcline74"> 74</a></span><span class="line">    <span class="mxinfo " id="T108:U47"><span class="var type1" id="S33T108U162">a</span>             = double(<span class="mxinfo " id="T108:U49"><span class="var type1" id="S31T104U166">lab_DRC_image</span>(<span class="mxinfo " id="T120:U51">:</span>,<span class="mxinfo " id="T119:U52">:</span>,<span class="mxinfo " id="T21:U53">2</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="2,75" id="srcline75"> 75</a></span><span class="line">    <span class="mxinfo " id="T108:U54"><span class="var type1" id="S35T108U172">b</span>             = double(<span class="mxinfo " id="T108:U56"><span class="var type1" id="S31T104U176">lab_DRC_image</span>(<span class="mxinfo " id="T120:U58">:</span>,<span class="mxinfo " id="T119:U59">:</span>,<span class="mxinfo " id="T21:U60">3</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="2,76" id="srcline76"> 76</a></span><span class="line">    <span class="mxinfo " id="T114:U61"><span class="var type1" id="S36T114U182">distance</span>      = <span class="mxinfo " id="T114:U63">zeros(<span class="mxinfo " id="T78:U64"><span class="potentialdiff PD6">[<span class="mxinfo " id="T3:U65">size(<span class="var type1" id="S33T108U189">a</span>,1)</span>, <span class="mxinfo " id="T3:U67">size(<span class="var type1" id="S33T108U193">a</span>,2)</span>, <span class="var type1" id="S21T3U195">nColors</span>]</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="2,77" id="srcline77"> 77</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="2,78" id="srcline78"> 78</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S38T3U198">count</span> = <span class="potentialdiff PD2"><span class="mxinfo " id="T3:U71">1</span>:<span class="var type1" id="S21T3U201">nColors</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="2,79" id="srcline79"> 79</a></span><span class="line">      <span class="mxinfo " id="T108:U73"><span class="mxinfo " id="T108:U74"><span class="var type1" id="S36T114U205">distance</span>(<span class="mxinfo " id="T120:U76">:</span>,<span class="mxinfo " id="T119:U77">:</span>,<span class="mxinfo " id="T3:U78"><span class="var type1" id="S38T3U208"><span class="potentialdiff PD4">count</span></span></span>)</span> = <span class="mxinfo " id="T108:U79"><span class="potentialdiff PD1">( <span class="mxinfo " id="T108:U80"><span class="potentialdiff PD5"><span class="mxinfo " id="T108:U81">(<span class="mxinfo " id="T108:U82"><span class="var type1" id="S33T108U215">a</span> - <span class="mxinfo " id="T3:U84"><span class="var type1" id="S23T10U217">color_markers</span>(<span class="var type1" id="S38T3U218">count</span>,<span class="mxinfo " id="T3:U87">1</span>)</span></span>).^2</span> + <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,80" id="srcline80"> 80</a></span><span class="line">                              <span class="mxinfo " id="T108:U88">(<span class="mxinfo " id="T108:U89"><span class="var type1" id="S35T108U224">b</span> - <span class="mxinfo " id="T3:U91"><span class="var type1" id="S23T10U226">color_markers</span>(<span class="var type1" id="S38T3U227">count</span>,<span class="mxinfo " id="T3:U94">2</span>)</span></span>).^2</span></span></span> ).^0.5</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="2,81" id="srcline81"> 81</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,82" id="srcline82"> 82</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="2,83" id="srcline83"> 83</a></span><span class="line">    <span class="comment">% Now which 3rd dim "page" had the smallest distance for each pixel.</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,84" id="srcline84"> 84</a></span><span class="line">    <span class="comment">% - REMEMBER that the ind variable will be an MxN matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,85" id="srcline85"> 85</a></span><span class="line">    <span class="potentialdiff PD9">[<span class="mxinfo " id="T108:U95">~</span>, <span class="var type1" id="S39T108U235">ind</span>] = min(<span class="var type1" id="S36T114U238">distance</span>,[],3)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="2,86" id="srcline86"> 86</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="2,87" id="srcline87"> 87</a></span><span class="line">    <span class="comment">% Now create a label matrix, which is the same size as the DRC_image </span></span></span>
<span class="srcline"><span class="lineno"><a href="2,88" id="srcline88"> 88</a></span><span class="line">    <span class="comment">% matrix <span class="keyword">...</span><span class="comment"> but it contains label IDs for each pixel</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="2,89" id="srcline89"> 89</a></span><span class="line">    <span class="mxinfo " id="T12:U98"><span class="var type1" id="S41T12U244">label</span>      = <span class="mxinfo " id="T108:U100"><span class="potentialdiff PD3"><span class="var type1" id="S22T9U246">color_labels</span>(<span class="var type1" id="S39T108U247">ind</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="2,90" id="srcline90"> 90</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="2,91" id="srcline91"> 91</a></span><span class="line">    <span class="comment">% reset label to the ORIGINAL image size</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,92" id="srcline92"> 92</a></span><span class="line">    <span class="comment">%  - use a label_ID of 100 to indicate "I don't care"</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,93" id="srcline93"> 93</a></span><span class="line">    <span class="keyword">if</span>(<span class="mxinfo " id="T5:U103"><span class="var type1" id="S27T3U252">rmin</span>&gt;<span class="mxinfo " id="T3:U105">1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="2,94" id="srcline94"> 94</a></span><span class="line">        <span class="mxinfo " id="T12:U106"><span class="var type1" id="S41T12U256">label</span>      = <span class="mxinfo " id="T12:U108">[ <span class="mxinfo " id="T118:U109"><span class="mxinfo " id="T3:U110">100</span>*<span class="mxinfo " id="T118:U111">ones((<span class="mxinfo " id="T3:U112"><span class="var type1" id="S27T3U265">rmin</span>-<span class="mxinfo " id="T3:U114">1</span></span>),<span class="var type1" id="S26T3U267">NUM_COLS</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="2,95" id="srcline95"> 95</a></span><span class="line">                       <span class="var type1" id="S41T12U269">label</span> ]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="2,96" id="srcline96"> 96</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,97" id="srcline97"> 97</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="2,98" id="srcline98"> 98</a></span><span class="line">    <span class="comment">% store the outputs</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,99" id="srcline99"> 99</a></span><span class="line">    <span class="mxinfo " id="T12:U117"><span class="mxinfo " id="T12:U118"><span class="var type1" id="S19T11U273">OBJ</span>.label</span>         = <span class="var type1" id="S41T12U275">label</span></span>;    <span class="comment">% a 2D matrix of label IDs for each pixel</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,100" id="srcline100">100</a></span><span class="line"><span class="keyword">end</span> <span class="comment">% classify(OBJ)</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,101" id="srcline101">101</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
</pre>
<div class="dead">
<pre class="code">
<span class="srcline"><span class="lineno"><a href="2,102" id="srcline102">102</a></span><span class="line"><span class="keyword">function</span> plot_labels(OBJ, I)</span></span>
<span class="srcline"><span class="lineno"><a href="2,103" id="srcline103">103</a></span><span class="line">    <span class="keyword">if</span>(1 ==coder.target(<span class="string">'MATLAB'</span>) )</span></span>
<span class="srcline"><span class="lineno"><a href="2,104" id="srcline104">104</a></span><span class="line">        nColors           = OBJ.nColors;</span></span>
<span class="srcline"><span class="lineno"><a href="2,105" id="srcline105">105</a></span><span class="line">        color_labels      = OBJ.color_labels;</span></span>
<span class="srcline"><span class="lineno"><a href="2,106" id="srcline106">106</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,107" id="srcline107">107</a></span><span class="line">        rgb_label        = repmat(OBJ.label,[1 1 3]);</span></span>
<span class="srcline"><span class="lineno"><a href="2,108" id="srcline108">108</a></span><span class="line">        segmented_images = zeros([size(I), nColors],<span class="string">'uint8'</span>);  <span class="comment">% a 4D matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,109" id="srcline109">109</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,110" id="srcline110">110</a></span><span class="line">        <span class="keyword">for</span> count = 1:nColors</span></span>
<span class="srcline"><span class="lineno"><a href="2,111" id="srcline111">111</a></span><span class="line">          color = I;</span></span>
<span class="srcline"><span class="lineno"><a href="2,112" id="srcline112">112</a></span><span class="line">          color(rgb_label ~= color_labels(count)) = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="2,113" id="srcline113">113</a></span><span class="line">          segmented_images(:,:,:,count) = color;</span></span>
<span class="srcline"><span class="lineno"><a href="2,114" id="srcline114">114</a></span><span class="line">        <span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="2,115" id="srcline115">115</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,116" id="srcline116">116</a></span><span class="line">        figure</span></span>
<span class="srcline"><span class="lineno"><a href="2,117" id="srcline117">117</a></span><span class="line">        <span class="keyword">for</span> kk=1:nColors   </span></span>
<span class="srcline"><span class="lineno"><a href="2,118" id="srcline118">118</a></span><span class="line">            I     = segmented_images(:,:,:,kk);</span></span>
<span class="srcline"><span class="lineno"><a href="2,119" id="srcline119">119</a></span><span class="line">            tmp_str = sprintf(<span class="string">'Color_%d'</span>,kk);</span></span>
<span class="srcline"><span class="lineno"><a href="2,120" id="srcline120">120</a></span><span class="line">            subplot(2,3,kk);  imshow(I),title(tmp_str, <span class="string">'Interpreter'</span>, <span class="string">'none'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="2,121" id="srcline121">121</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,122" id="srcline122">122</a></span><span class="line">    <span class="keyword">end</span> <span class="comment">% if(1 ==coder.target('MATLAB') )</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,123" id="srcline123">123</a></span><span class="line"><span class="keyword">end</span> <span class="comment">% plot_labels(OBJ)</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,124" id="srcline124">124</a></span><span class="line"><span class="comment">%-------------------------------------------------------------------------- </span></span></span>
<span class="srcline"><span class="lineno"><a href="2,125" id="srcline125">125</a></span><span class="line"><span class="keyword">function</span> [ new_BW_blue,       <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,126" id="srcline126">126</a></span><span class="line">           new_BW_yell,       <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,127" id="srcline127">127</a></span><span class="line">           tf_found_blue_lane,   <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,128" id="srcline128">128</a></span><span class="line">           tf_found_yell_lane] = find_thin_lane_markings(OBJ, varargin)</span></span>
<span class="srcline"><span class="lineno"><a href="2,129" id="srcline129">129</a></span><span class="line"><span class="comment">% ALLOWED usage:</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,130" id="srcline130">130</a></span><span class="line"><span class="comment">%  &gt;&gt; [BW_b, BW_y, tf_found_blue_lane, tf_found_yell_lane] = OBJ.find_thin_lane_markings()</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,131" id="srcline131">131</a></span><span class="line"><span class="comment">%  &gt;&gt; [BW_b, BW_y, tf_found_blue_lane, tf_found_yell_lane] = OBJ.find_thin_lane_markings('do_plots')</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,132" id="srcline132">132</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,133" id="srcline133">133</a></span><span class="line">    <span class="keyword">if</span>(isempty(varargin) )</span></span>
<span class="srcline"><span class="lineno"><a href="2,134" id="srcline134">134</a></span><span class="line">        tf_do_plots = false;</span></span>
<span class="srcline"><span class="lineno"><a href="2,135" id="srcline135">135</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,136" id="srcline136">136</a></span><span class="line">        tf_do_plots = true;</span></span>
<span class="srcline"><span class="lineno"><a href="2,137" id="srcline137">137</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,138" id="srcline138">138</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,139" id="srcline139">139</a></span><span class="line">    <span class="comment">%Let's look for the BLUE and YELLOW lane markings:</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,140" id="srcline140">140</a></span><span class="line">    BW_blue   = OBJ.label == 0; <span class="comment">% blue has a label ID of 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,141" id="srcline141">141</a></span><span class="line">    BW_yellow = OBJ.label == 1; <span class="comment">% yellow has a label ID of 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,142" id="srcline142">142</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="2,143" id="srcline143">143</a></span><span class="line">    <span class="comment">%Ignore the top half of the image:</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,144" id="srcline144">144</a></span><span class="line">    THE_FRACT = OBJ.fraction_of_img_to_ignore;</span></span>
<span class="srcline"><span class="lineno"><a href="2,145" id="srcline145">145</a></span><span class="line">    BW_blue   = bh_mask_fraction_of_BW_image(BW_blue,   THE_FRACT);</span></span>
<span class="srcline"><span class="lineno"><a href="2,146" id="srcline146">146</a></span><span class="line">    BW_yellow = bh_mask_fraction_of_BW_image(BW_yellow, THE_FRACT);</span></span>
<span class="srcline"><span class="lineno"><a href="2,147" id="srcline147">147</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="2,148" id="srcline148">148</a></span><span class="line">    <span class="comment">% Process the BLUE and YELLOW BW images:</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,149" id="srcline149">149</a></span><span class="line">    [new_BW_blue, tf_found_blue_lane] = LOC_find_thin_lane_marking(OBJ, BW_blue);</span></span>
<span class="srcline"><span class="lineno"><a href="2,150" id="srcline150">150</a></span><span class="line">    [new_BW_yell, tf_found_yell_lane] = LOC_find_thin_lane_marking(OBJ, BW_yellow);</span></span>
<span class="srcline"><span class="lineno"><a href="2,151" id="srcline151">151</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="2,152" id="srcline152">152</a></span><span class="line">    <span class="keyword">if</span>(1 ==coder.target(<span class="string">'MATLAB'</span>) )</span></span>
<span class="srcline"><span class="lineno"><a href="2,153" id="srcline153">153</a></span><span class="line">        <span class="keyword">if</span>(tf_do_plots)</span></span>
<span class="srcline"><span class="lineno"><a href="2,154" id="srcline154">154</a></span><span class="line">           figure; </span></span>
<span class="srcline"><span class="lineno"><a href="2,155" id="srcline155">155</a></span><span class="line">           subplot(1,2,1); imshow(new_BW_blue);   title(<span class="string">'BLUE   lane'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="2,156" id="srcline156">156</a></span><span class="line">           subplot(1,2,2); imshow(new_BW_yellow); title(<span class="string">'YELLOW lane'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="2,157" id="srcline157">157</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,158" id="srcline158">158</a></span><span class="line">    <span class="keyword">end</span> <span class="comment">% if(1 ==coder.target('MATLAB') )</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,159" id="srcline159">159</a></span><span class="line"><span class="keyword">end</span> <span class="comment">%find_thin_lane_markings(OBJ)</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,160" id="srcline160">160</a></span><span class="line"><span class="comment">%-------------------------------------------------------------------------- </span></span></span>
<span class="srcline"><span class="lineno"><a href="2,161" id="srcline161">161</a></span><span class="line"><span class="keyword">function</span> [ new_BW_purp, tf_found_purp_blob] = find_purp_boxes(OBJ, varargin)</span></span>
<span class="srcline"><span class="lineno"><a href="2,162" id="srcline162">162</a></span><span class="line"><span class="comment">% ALLOWED usage:</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,163" id="srcline163">163</a></span><span class="line"><span class="comment">%  &gt;&gt; [ new_BW_purple, tf_found_purp_blob] = OBJ.find_purp_boxes()</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,164" id="srcline164">164</a></span><span class="line"><span class="comment">%  &gt;&gt; [ new_BW_purple, tf_found_purp_blob] = OBJ.find_purp_boxes('do_plots')</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,165" id="srcline165">165</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,166" id="srcline166">166</a></span><span class="line">    <span class="keyword">if</span>(isempty(varargin) )</span></span>
<span class="srcline"><span class="lineno"><a href="2,167" id="srcline167">167</a></span><span class="line">        tf_do_plots = false;</span></span>
<span class="srcline"><span class="lineno"><a href="2,168" id="srcline168">168</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,169" id="srcline169">169</a></span><span class="line">        tf_do_plots = true;</span></span>
<span class="srcline"><span class="lineno"><a href="2,170" id="srcline170">170</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,171" id="srcline171">171</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="2,172" id="srcline172">172</a></span><span class="line">    BW_purple   = OBJ.label == 2;</span></span>
<span class="srcline"><span class="lineno"><a href="2,173" id="srcline173">173</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="2,174" id="srcline174">174</a></span><span class="line">    <span class="comment">%Ignore the top half of the image:</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,175" id="srcline175">175</a></span><span class="line">    THE_FRACT = OBJ.fraction_of_img_to_ignore;</span></span>
<span class="srcline"><span class="lineno"><a href="2,176" id="srcline176">176</a></span><span class="line">    BW_purple = bh_mask_fraction_of_BW_image(BW_purple, THE_FRACT);</span></span>
<span class="srcline"><span class="lineno"><a href="2,177" id="srcline177">177</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="2,178" id="srcline178">178</a></span><span class="line">    <span class="comment">% Process the PURPLE BW images:</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,179" id="srcline179">179</a></span><span class="line">    [new_BW_purp, tf_found_purp_blob] = LOC_find_purp_boxes(OBJ, BW_purple);</span></span>
<span class="srcline"><span class="lineno"><a href="2,180" id="srcline180">180</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="2,181" id="srcline181">181</a></span><span class="line">    <span class="keyword">if</span>(1 ==coder.target(<span class="string">'MATLAB'</span>) )</span></span>
<span class="srcline"><span class="lineno"><a href="2,182" id="srcline182">182</a></span><span class="line">        <span class="keyword">if</span>(tf_do_plots)</span></span>
<span class="srcline"><span class="lineno"><a href="2,183" id="srcline183">183</a></span><span class="line">           figure; </span></span>
<span class="srcline"><span class="lineno"><a href="2,184" id="srcline184">184</a></span><span class="line">           imshow(new_BW_purple); title(<span class="string">'PURPLE   obstacle'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="2,185" id="srcline185">185</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,186" id="srcline186">186</a></span><span class="line">    <span class="keyword">end</span> <span class="comment">% if(1 ==coder.target('MATLAB') )</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,187" id="srcline187">187</a></span><span class="line"><span class="keyword">end</span> <span class="comment">% find_purp_boxes()</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,188" id="srcline188">188</a></span><span class="line"><span class="comment">%-------------------------------------------------------------------------- </span></span></span>
<span class="srcline"><span class="lineno"><a href="2,189" id="srcline189">189</a></span><span class="line"><span class="keyword">function</span> [  BLUE_s, YELLOW_s, PURP_s ] = find_all_stuff(OBJ, varargin)</span></span>
<span class="srcline"><span class="lineno"><a href="2,190" id="srcline190">190</a></span><span class="line"><span class="comment">% ALLOWED usage:</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,191" id="srcline191">191</a></span><span class="line"><span class="comment">%  &gt;&gt; [     BLUE_s, YELLOW_s, PURP_s ] = OBJ.find_all_stuff()</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,192" id="srcline192">192</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,193" id="srcline193">193</a></span><span class="line">   [ BW_b,                <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,194" id="srcline194">194</a></span><span class="line">     BW_y,                <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,195" id="srcline195">195</a></span><span class="line">     tf_found_b,          <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,196" id="srcline196">196</a></span><span class="line">     tf_found_y] = OBJ.find_thin_lane_markings();</span></span>
<span class="srcline"><span class="lineno"><a href="2,197" id="srcline197">197</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,198" id="srcline198">198</a></span><span class="line">   [ BW_p, tf_found_p] = OBJ.find_purp_boxes(); </span></span>
<span class="srcline"><span class="lineno"><a href="2,199" id="srcline199">199</a></span><span class="line">   </span></span>
<span class="srcline"><span class="lineno"><a href="2,200" id="srcline200">200</a></span><span class="line">   <span class="comment">% disable the warning about converting an OBJ to a STRUCT</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,201" id="srcline201">201</a></span><span class="line">    <span class="keyword">if</span>(1 ==coder.target(<span class="string">'MATLAB'</span>) )</span></span>
<span class="srcline"><span class="lineno"><a href="2,202" id="srcline202">202</a></span><span class="line">       warning(<span class="string">'off'</span>, <span class="string">'MATLAB:structOnObject'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="2,203" id="srcline203">203</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,204" id="srcline204">204</a></span><span class="line">   </span></span>
<span class="srcline"><span class="lineno"><a href="2,205" id="srcline205">205</a></span><span class="line">   <span class="comment">% take care of the OUTPUTS:    USAGE MODE #1</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,206" id="srcline206">206</a></span><span class="line">      BLUE_O = lane_info_CLS(BW_b, tf_found_b);</span></span>
<span class="srcline"><span class="lineno"><a href="2,207" id="srcline207">207</a></span><span class="line">      YELL_O = lane_info_CLS(BW_y, tf_found_y);</span></span>
<span class="srcline"><span class="lineno"><a href="2,208" id="srcline208">208</a></span><span class="line">      PURP_O = box_info_CLS( BW_p, tf_found_p);</span></span>
<span class="srcline"><span class="lineno"><a href="2,209" id="srcline209">209</a></span><span class="line">       </span></span>
<span class="srcline"><span class="lineno"><a href="2,210" id="srcline210">210</a></span><span class="line">      BLUE_s   = BLUE_O.convert_to_struct();</span></span>
<span class="srcline"><span class="lineno"><a href="2,211" id="srcline211">211</a></span><span class="line">      YELLOW_s = YELL_O.convert_to_struct();</span></span>
<span class="srcline"><span class="lineno"><a href="2,212" id="srcline212">212</a></span><span class="line">      PURP_s   = PURP_O.convert_to_struct();  </span></span>
<span class="srcline"><span class="lineno"><a href="2,213" id="srcline213">213</a></span><span class="line">  </span></span>
<span class="srcline"><span class="lineno"><a href="2,214" id="srcline214">214</a></span><span class="line"><span class="keyword">end</span> <span class="comment">% find_all_stuff()</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,215" id="srcline215">215</a></span><span class="line"><span class="comment">%-------------------------------------------------------------------------- </span></span></span>
<span class="srcline"><span class="lineno"><a href="2,216" id="srcline216">216</a></span><span class="line"><span class="keyword">end</span> <span class="comment">% methods</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,217" id="srcline217">217</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,218" id="srcline218">218</a></span><span class="line"><span class="keyword">end</span> <span class="comment">% classdef</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,219" id="srcline219">219</a></span><span class="line"><span class="comment">%_#########################################################################</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,220" id="srcline220">220</a></span><span class="line"><span class="comment">% END CLASSDEF</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,221" id="srcline221">221</a></span><span class="line"><span class="comment">%_#########################################################################</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,222" id="srcline222">222</a></span><span class="line"><span class="keyword">function</span> [new_BW, tf_found_it] = LOC_find_thin_lane_marking(OBJ, BW)</span></span>
<span class="srcline"><span class="lineno"><a href="2,223" id="srcline223">223</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,224" id="srcline224">224</a></span><span class="line">    new_BW      = false( size(BW) );</span></span>
<span class="srcline"><span class="lineno"><a href="2,225" id="srcline225">225</a></span><span class="line">    tf_found_it = false;</span></span>
<span class="srcline"><span class="lineno"><a href="2,226" id="srcline226">226</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="2,227" id="srcline227">227</a></span><span class="line">    <span class="comment">% Process the BLUE BW image:</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,228" id="srcline228">228</a></span><span class="line">    stats = regionprops(<span class="string">'struct'</span>, BW, <span class="string">'Orientation'</span>,<span class="string">'Eccentricity'</span>,<span class="string">'Area'</span>,<span class="string">'PixelIdxList'</span> );</span></span>
<span class="srcline"><span class="lineno"><a href="2,229" id="srcline229">229</a></span><span class="line">    <span class="keyword">if</span>( isempty(stats) )</span></span>
<span class="srcline"><span class="lineno"><a href="2,230" id="srcline230">230</a></span><span class="line">        <span class="keyword">return</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,231" id="srcline231">231</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,232" id="srcline232">232</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="2,233" id="srcline233">233</a></span><span class="line">    <span class="comment">% sort based on Eccentricity</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,234" id="srcline234">234</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,235" id="srcline235">235</a></span><span class="line">    <span class="comment">% I want the code to be MATLAB Coder friendly</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,236" id="srcline236">236</a></span><span class="line">    <span class="comment">%     [~,ind] = sort( [stats.Eccentricity], 'descend' );</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,237" id="srcline237">237</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,238" id="srcline238">238</a></span><span class="line">    tmp_E = zeros(1, length(stats));</span></span>
<span class="srcline"><span class="lineno"><a href="2,239" id="srcline239">239</a></span><span class="line">    <span class="keyword">for</span> kk=1:length(stats)</span></span>
<span class="srcline"><span class="lineno"><a href="2,240" id="srcline240">240</a></span><span class="line">        tmp_E(kk) = stats(kk).Eccentricity;</span></span>
<span class="srcline"><span class="lineno"><a href="2,241" id="srcline241">241</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,242" id="srcline242">242</a></span><span class="line">    [~,ind] = sort( tmp_E, <span class="string">'descend'</span> );</span></span>
<span class="srcline"><span class="lineno"><a href="2,243" id="srcline243">243</a></span><span class="line">    stats   = stats(ind,:);</span></span>
<span class="srcline"><span class="lineno"><a href="2,244" id="srcline244">244</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="2,245" id="srcline245">245</a></span><span class="line">    A = zeros(1, length(stats));</span></span>
<span class="srcline"><span class="lineno"><a href="2,246" id="srcline246">246</a></span><span class="line">    E = zeros(1, length(stats));</span></span>
<span class="srcline"><span class="lineno"><a href="2,247" id="srcline247">247</a></span><span class="line">    O = zeros(1, length(stats));</span></span>
<span class="srcline"><span class="lineno"><a href="2,248" id="srcline248">248</a></span><span class="line">    <span class="keyword">for</span> kk=1:length(stats)</span></span>
<span class="srcline"><span class="lineno"><a href="2,249" id="srcline249">249</a></span><span class="line">        A(kk) = stats(kk).Area;</span></span>
<span class="srcline"><span class="lineno"><a href="2,250" id="srcline250">250</a></span><span class="line">        E(kk) = stats(kk).Eccentricity;</span></span>
<span class="srcline"><span class="lineno"><a href="2,251" id="srcline251">251</a></span><span class="line">        O(kk) = stats(kk).Orientation;</span></span>
<span class="srcline"><span class="lineno"><a href="2,252" id="srcline252">252</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,253" id="srcline253">253</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="2,254" id="srcline254">254</a></span><span class="line"><span class="comment">%     A     = stats.Area;</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,255" id="srcline255">255</a></span><span class="line"><span class="comment">%     E     = stats.Eccentricity;</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,256" id="srcline256">256</a></span><span class="line"><span class="comment">%     O     = stats.Orientation;</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,257" id="srcline257">257</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,258" id="srcline258">258</a></span><span class="line">    A_min = OBJ.A_tgt_for_lane * size(BW,1)/480;</span></span>
<span class="srcline"><span class="lineno"><a href="2,259" id="srcline259">259</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,260" id="srcline260">260</a></span><span class="line"><span class="comment">%     ind   = find(E &gt; OBJ.E_tgt_for_lane  &amp; <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="2,261" id="srcline261">261</a></span><span class="line"><span class="comment">%                  A &gt; A_min &amp;  <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="2,262" id="srcline262">262</a></span><span class="line"><span class="comment">%                  ((O &gt; 10 &amp; O &lt; 70) | (O &lt; -10 &amp; O &gt; -70)) <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="2,263" id="srcline263">263</a></span><span class="line"><span class="comment">%                  );</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,264" id="srcline264">264</a></span><span class="line">    ind   = find(E &gt; OBJ.E_tgt_for_lane  &amp; <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,265" id="srcline265">265</a></span><span class="line">                 A &gt; A_min &amp;  <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,266" id="srcline266">266</a></span><span class="line">                 ((O &gt; 10 &amp; O &lt; 80) | (O &lt; -10 &amp; O &gt; -80)) <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,267" id="srcline267">267</a></span><span class="line">                 );</span></span>
<span class="srcline"><span class="lineno"><a href="2,268" id="srcline268">268</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,269" id="srcline269">269</a></span><span class="line">    <span class="keyword">if</span>( ~isempty(ind) )         </span></span>
<span class="srcline"><span class="lineno"><a href="2,270" id="srcline270">270</a></span><span class="line">       IND          = ind(1);</span></span>
<span class="srcline"><span class="lineno"><a href="2,271" id="srcline271">271</a></span><span class="line">       PixelIdxList = stats(IND).PixelIdxList;</span></span>
<span class="srcline"><span class="lineno"><a href="2,272" id="srcline272">272</a></span><span class="line">       new_BW(PixelIdxList) = true;</span></span>
<span class="srcline"><span class="lineno"><a href="2,273" id="srcline273">273</a></span><span class="line">       tf_found_it          = true;</span></span>
<span class="srcline"><span class="lineno"><a href="2,274" id="srcline274">274</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,275" id="srcline275">275</a></span><span class="line"><span class="keyword">end</span> <span class="comment">% LOC_find_thin_lane_marking</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,276" id="srcline276">276</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,277" id="srcline277">277</a></span><span class="line"><span class="keyword">function</span> [new_BW, tf_found_it] = LOC_find_purp_boxes(OBJ, BW)</span></span>
<span class="srcline"><span class="lineno"><a href="2,278" id="srcline278">278</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,279" id="srcline279">279</a></span><span class="line">    new_BW      = false( size(BW) );</span></span>
<span class="srcline"><span class="lineno"><a href="2,280" id="srcline280">280</a></span><span class="line">    tf_found_it = false;</span></span>
<span class="srcline"><span class="lineno"><a href="2,281" id="srcline281">281</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="2,282" id="srcline282">282</a></span><span class="line">    stats = regionprops( BW, <span class="string">'Area'</span>,<span class="string">'Eccentricity'</span>,<span class="string">'PixelIdxList'</span> );</span></span>
<span class="srcline"><span class="lineno"><a href="2,283" id="srcline283">283</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,284" id="srcline284">284</a></span><span class="line">    <span class="keyword">if</span>( isempty(stats) )</span></span>
<span class="srcline"><span class="lineno"><a href="2,285" id="srcline285">285</a></span><span class="line">        <span class="keyword">return</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,286" id="srcline286">286</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,287" id="srcline287">287</a></span><span class="line">  </span></span>
<span class="srcline"><span class="lineno"><a href="2,288" id="srcline288">288</a></span><span class="line">    <span class="comment">% I want the code to be MATLAB Coder friendly</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,289" id="srcline289">289</a></span><span class="line">    <span class="comment">%     A     = [stats.Area]';</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,290" id="srcline290">290</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,291" id="srcline291">291</a></span><span class="line">    A = zeros(1, length(stats));</span></span>
<span class="srcline"><span class="lineno"><a href="2,292" id="srcline292">292</a></span><span class="line">    <span class="keyword">for</span> kk=1:length(stats)</span></span>
<span class="srcline"><span class="lineno"><a href="2,293" id="srcline293">293</a></span><span class="line">        A(kk) = stats(kk).Area;</span></span>
<span class="srcline"><span class="lineno"><a href="2,294" id="srcline294">294</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,295" id="srcline295">295</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="2,296" id="srcline296">296</a></span><span class="line">    [~,ind] = sort(A,<span class="string">'descend'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="2,297" id="srcline297">297</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,298" id="srcline298">298</a></span><span class="line">    stats = stats(ind);</span></span>
<span class="srcline"><span class="lineno"><a href="2,299" id="srcline299">299</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,300" id="srcline300">300</a></span><span class="line">    <span class="comment">% take the BIGGEST purple blob you can see</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,301" id="srcline301">301</a></span><span class="line">    IND = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="2,302" id="srcline302">302</a></span><span class="line">    PixelIdxList = stats(IND).PixelIdxList;</span></span>
<span class="srcline"><span class="lineno"><a href="2,303" id="srcline303">303</a></span><span class="line">    new_BW(PixelIdxList) = true;    </span></span>
<span class="srcline"><span class="lineno"><a href="2,304" id="srcline304">304</a></span><span class="line">    tf_found_it          = true;</span></span>
<span class="srcline"><span class="lineno"><a href="2,305" id="srcline305">305</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,306" id="srcline306">306</a></span><span class="line"><span class="keyword">end</span> <span class="comment">% LOC_find_purp_boxes</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,307" id="srcline307">307</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,308" id="srcline308">308</a></span><span class="line"><span class="keyword">function</span> A_tab = LOC_get_init_region_polygons()</span></span>
<span class="srcline"><span class="lineno"><a href="2,309" id="srcline309">309</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,310" id="srcline310">310</a></span><span class="line"><span class="comment">% ATTENTION: </span></span></span>
<span class="srcline"><span class="lineno"><a href="2,311" id="srcline311">311</a></span><span class="line"><span class="comment">%   I want this to be MATLAB Coder friendly <span class="keyword">...</span><span class="comment"> which means I canNOT use</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="2,312" id="srcline312">312</a></span><span class="line"><span class="comment">%     a.) the readtatble() function</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,313" id="srcline313">313</a></span><span class="line"><span class="comment">%     b.) dynamic field names</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,314" id="srcline314">314</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,315" id="srcline315">315</a></span><span class="line">    <span class="comment">% read color database</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,316" id="srcline316">316</a></span><span class="line">    <span class="comment">% XLS_file = OBJ.ref_color_database_XLS_file;</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,317" id="srcline317">317</a></span><span class="line">    <span class="comment">% A_tab    = readtable(XLS_file, 'Sheet', 'ALL');</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,318" id="srcline318">318</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="2,319" id="srcline319">319</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="2,320" id="srcline320">320</a></span><span class="line">my_field_names = {<span class="string">'blue_x'</span>,	<span class="string">'blue_y'</span>,	<span class="string">'yellow_x'</span>,	<span class="string">'yellow_y'</span>,	<span class="string">'purple_x'</span>,	<span class="string">'purple_y'</span>,	<span class="string">'green_x'</span>,	<span class="string">'green_y'</span>,	<span class="string">'grey_rim_x'</span>,	<span class="string">'grey_rim_y'</span>,	<span class="string">'pavers_x'</span>,	<span class="string">'pavers_y'</span>};</span></span>
<span class="srcline"><span class="lineno"><a href="2,321" id="srcline321">321</a></span><span class="line">my_data_mat = [ <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,322" id="srcline322">322</a></span><span class="line">    71.71697553	353.0669119	524.0815555	337.9827771	195.7952169	256.6447939	596.4460635	281.4453386	551.8817602	308.1842461	334.653703	365.3371908;</span></span>
<span class="srcline"><span class="lineno"><a href="2,323" id="srcline323">323</a></span><span class="line">    73.03604728	357.0974089	571.3142281	366.6002199	218.9600644	307.9669129	616.2111788	292.4414238	610.4835932	336.965028	341.6691441	404.3605818;</span></span>
<span class="srcline"><span class="lineno"><a href="2,324" id="srcline324">324</a></span><span class="line">    104.4006423	348.5234425	575.8985757	360.4877564	244.9206694	282.2060049	637.3682036	293.6941424	612.7953026	310.4959555	398.0849827	409.7683176;</span></span>
<span class="srcline"><span class="lineno"><a href="2,325" id="srcline325">325</a></span><span class="line">    103.1548523	344.639509	518.2469312	328.5362426	224.5515793	241.0684309	638.2033493	280.6101928	546.7959995	290.9620112	403.4927185	364.1679507;</span></span>
<span class="srcline"><span class="lineno"><a href="2,326" id="srcline326">326</a></span><span class="line">    71.71697553	353.0669119	524.0815555	337.9827771	195.7952169	256.6447939	596.4460635	281.4453386	551.8817602	308.1842461	334.653703	365.3371908;</span></span>
<span class="srcline"><span class="lineno"><a href="2,327" id="srcline327">327</a></span><span class="line">    ];</span></span>
<span class="srcline"><span class="lineno"><a href="2,328" id="srcline328">328</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,329" id="srcline329">329</a></span><span class="line">    A_tab.blue_x	  = my_data_mat(:,1);</span></span>
<span class="srcline"><span class="lineno"><a href="2,330" id="srcline330">330</a></span><span class="line">    A_tab.blue_y	  = my_data_mat(:,2);</span></span>
<span class="srcline"><span class="lineno"><a href="2,331" id="srcline331">331</a></span><span class="line">    A_tab.yellow_x	  = my_data_mat(:,3);</span></span>
<span class="srcline"><span class="lineno"><a href="2,332" id="srcline332">332</a></span><span class="line">    A_tab.yellow_y	  = my_data_mat(:,4);</span></span>
<span class="srcline"><span class="lineno"><a href="2,333" id="srcline333">333</a></span><span class="line">    A_tab.purple_x	  = my_data_mat(:,5);</span></span>
<span class="srcline"><span class="lineno"><a href="2,334" id="srcline334">334</a></span><span class="line">    A_tab.purple_y	  = my_data_mat(:,6);</span></span>
<span class="srcline"><span class="lineno"><a href="2,335" id="srcline335">335</a></span><span class="line">    A_tab.green_x	  = my_data_mat(:,7);</span></span>
<span class="srcline"><span class="lineno"><a href="2,336" id="srcline336">336</a></span><span class="line">    A_tab.green_y	  = my_data_mat(:,8);</span></span>
<span class="srcline"><span class="lineno"><a href="2,337" id="srcline337">337</a></span><span class="line">    A_tab.grey_rim_x  = my_data_mat(:,9);	</span></span>
<span class="srcline"><span class="lineno"><a href="2,338" id="srcline338">338</a></span><span class="line">    A_tab.grey_rim_y  = my_data_mat(:,10);</span></span>
<span class="srcline"><span class="lineno"><a href="2,339" id="srcline339">339</a></span><span class="line">    A_tab.pavers_x	  = my_data_mat(:,11);</span></span>
<span class="srcline"><span class="lineno"><a href="2,340" id="srcline340">340</a></span><span class="line">    A_tab.pavers_y    = my_data_mat(:,12);</span></span>
<span class="srcline"><span class="lineno"><a href="2,341" id="srcline341">341</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,342" id="srcline342">342</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,343" id="srcline343">343</a></span><span class="line"><span class="keyword">function</span> my_BW = bh_roipoly(I,cv,rv)</span></span>
<span class="srcline"><span class="lineno"><a href="2,344" id="srcline344">344</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,345" id="srcline345">345</a></span><span class="line">    <span class="comment">% the INPOLYGON approach</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,346" id="srcline346">346</a></span><span class="line">    <span class="comment">% in = inpolygon(xq,yq,xv,yv)</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,347" id="srcline347">347</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,348" id="srcline348">348</a></span><span class="line">    [NUM_IM_ROWS, NUM_IM_COLS,~] = size(I);</span></span>
<span class="srcline"><span class="lineno"><a href="2,349" id="srcline349">349</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,350" id="srcline350">350</a></span><span class="line">    <span class="comment">% generate a list of x and y corordinates</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,351" id="srcline351">351</a></span><span class="line">    uq_list  = zeros(NUM_IM_ROWS*NUM_IM_COLS, 1);</span></span>
<span class="srcline"><span class="lineno"><a href="2,352" id="srcline352">352</a></span><span class="line">    vq_list  = zeros(NUM_IM_ROWS*NUM_IM_COLS, 1);</span></span>
<span class="srcline"><span class="lineno"><a href="2,353" id="srcline353">353</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,354" id="srcline354">354</a></span><span class="line">    my_count =0;</span></span>
<span class="srcline"><span class="lineno"><a href="2,355" id="srcline355">355</a></span><span class="line">    <span class="keyword">for</span> kr=1:NUM_IM_ROWS</span></span>
<span class="srcline"><span class="lineno"><a href="2,356" id="srcline356">356</a></span><span class="line">        <span class="keyword">for</span> kc=1:NUM_IM_COLS</span></span>
<span class="srcline"><span class="lineno"><a href="2,357" id="srcline357">357</a></span><span class="line">            my_count =  my_count +1;</span></span>
<span class="srcline"><span class="lineno"><a href="2,358" id="srcline358">358</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,359" id="srcline359">359</a></span><span class="line">            uq_list(my_count) = kc;</span></span>
<span class="srcline"><span class="lineno"><a href="2,360" id="srcline360">360</a></span><span class="line">            vq_list(my_count) = kr;       </span></span>
<span class="srcline"><span class="lineno"><a href="2,361" id="srcline361">361</a></span><span class="line">        <span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="2,362" id="srcline362">362</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,363" id="srcline363">363</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,364" id="srcline364">364</a></span><span class="line">    <span class="comment">% which query co-ordinates are inside the polygon</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,365" id="srcline365">365</a></span><span class="line">    tf_in = inpolygon(uq_list, vq_list, cv,rv);</span></span>
<span class="srcline"><span class="lineno"><a href="2,366" id="srcline366">366</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,367" id="srcline367">367</a></span><span class="line">    <span class="comment">% now create the logical mask</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,368" id="srcline368">368</a></span><span class="line">    my_BW        = false(NUM_IM_ROWS, NUM_IM_COLS);</span></span>
<span class="srcline"><span class="lineno"><a href="2,369" id="srcline369">369</a></span><span class="line">    my_count =0;</span></span>
<span class="srcline"><span class="lineno"><a href="2,370" id="srcline370">370</a></span><span class="line">    <span class="keyword">for</span> kr=1:NUM_IM_ROWS</span></span>
<span class="srcline"><span class="lineno"><a href="2,371" id="srcline371">371</a></span><span class="line">        <span class="keyword">for</span> kc=1:NUM_IM_COLS</span></span>
<span class="srcline"><span class="lineno"><a href="2,372" id="srcline372">372</a></span><span class="line">            my_count =  my_count +1;</span></span>
<span class="srcline"><span class="lineno"><a href="2,373" id="srcline373">373</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,374" id="srcline374">374</a></span><span class="line">            <span class="keyword">if</span>(tf_in(my_count))</span></span>
<span class="srcline"><span class="lineno"><a href="2,375" id="srcline375">375</a></span><span class="line">                my_BW(kr,kc) = true;</span></span>
<span class="srcline"><span class="lineno"><a href="2,376" id="srcline376">376</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,377" id="srcline377">377</a></span><span class="line">        <span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="2,378" id="srcline378">378</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,379" id="srcline379">379</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="2,380" id="srcline380">380</a></span><span class="line"><span class="keyword">end</span> <span class="comment">% bh_roipoly()</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,381" id="srcline381">381</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="2,382" id="srcline382">382</a></span><span class="line"> </span></span>
</pre>
</div>
</body>
</html>
