<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="111,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">classdef</span> bh_line_homog_CLS <span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,2" id="srcline2">  2</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="111,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%  a.U + b.V + d = 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,4" id="srcline4">  4</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="111,5" id="srcline5">  5</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="111,6" id="srcline6">  6</a></span><span class="line"><span class="keyword">properties</span> (SetAccess = private)</span></span>
<span class="srcline"><span class="lineno"><a href="111,7" id="srcline7">  7</a></span><span class="line">    <span class="var type0" id="S2T0U10">abd_col</span> = [0;0;0];</span></span>
<span class="srcline"><span class="lineno"><a href="111,8" id="srcline8">  8</a></span><span class="line">    <span class="var type0" id="S3T0U19">a</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,9" id="srcline9">  9</a></span><span class="line">    <span class="var type0" id="S4T0U21">b</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,10" id="srcline10"> 10</a></span><span class="line">    <span class="var type0" id="S5T0U23">d</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,11" id="srcline11"> 11</a></span><span class="line">    <span class="var type0" id="S6T0U25">line_type</span> <span class="comment">%char {mustBeMember(line_type,{'HORZ','VERT','SLOPEY','UNKNOWN'})} = 'UNKNOWN';</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,12" id="srcline12"> 12</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,13" id="srcline13"> 13</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,14" id="srcline14"> 14</a></span><span class="line"><span class="keyword">methods</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,15" id="srcline15"> 15</a></span><span class="line"><span class="keyword">function</span> <span class="var type0" id="S8T0U29">OBJ</span> = bh_line_homog_CLS(<span class="var type0" id="S9T0U32">u</span>,<span class="var type0" id="S10T0U33">v</span>) </span></span>
<span class="srcline"><span class="lineno"><a href="111,16" id="srcline16"> 16</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="111,17" id="srcline17"> 17</a></span><span class="line"><span class="var type0" id="S9T0U36">u</span> = <span class="var type0" id="S9T0U38">u</span>(:);</span></span>
<span class="srcline"><span class="lineno"><a href="111,18" id="srcline18"> 18</a></span><span class="line"><span class="var type0" id="S10T0U42">v</span> = <span class="var type0" id="S10T0U44">v</span>(:);</span></span>
<span class="srcline"><span class="lineno"><a href="111,19" id="srcline19"> 19</a></span><span class="line"><span class="var type0" id="S11T0U48">A</span> = [<span class="var type0" id="S9T0U51">u</span>,<span class="var type0" id="S10T0U52">v</span>, ones(size(<span class="var type0" id="S9T0U57">u</span>))];</span></span>
<span class="srcline"><span class="lineno"><a href="111,20" id="srcline20"> 20</a></span><span class="line"><span class="var type0" id="S14T0U60">B</span> = [1,0,0;</span></span>
<span class="srcline"><span class="lineno"><a href="111,21" id="srcline21"> 21</a></span><span class="line">     0,1,0];</span></span>
<span class="srcline"><span class="lineno"><a href="111,22" id="srcline22"> 22</a></span><span class="line">[<span class="var type0" id="S15T0U73">eVec_mat</span>, <span class="var type0" id="S16T0U74">eVal_mat</span>] = eig(<span class="var type0" id="S11T0U79">A</span>'* <span class="var type0" id="S11T0U80">A</span>,  <span class="var type0" id="S14T0U83">B</span>'*<span class="var type0" id="S14T0U84">B</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="111,23" id="srcline23"> 23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">% for codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,25" id="srcline25"> 25</a></span><span class="line"><span class="var type0" id="S15T0U87">eVec_mat</span> = real(<span class="var type0" id="S15T0U90">eVec_mat</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="111,26" id="srcline26"> 26</a></span><span class="line"><span class="var type0" id="S16T0U93">eVal_mat</span> = real(<span class="var type0" id="S16T0U96">eVal_mat</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="111,27" id="srcline27"> 27</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">% where's the smallest eigenvalue</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,29" id="srcline29"> 29</a></span><span class="line">[~,<span class="var type0" id="S19T0U101">ind</span>]     = min(diag(<span class="var type0" id="S16T0U106">eVal_mat</span>));</span></span>
<span class="srcline"><span class="lineno"><a href="111,30" id="srcline30"> 30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,31" id="srcline31"> 31</a></span><span class="line"><span class="var type0" id="S22T0U109">THE_SOL_VEC</span> = <span class="var type0" id="S15T0U111">eVec_mat</span>(:,<span class="var type0" id="S19T0U113">ind</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="111,32" id="srcline32"> 32</a></span><span class="line"><span class="var type0" id="S23T0U116">normal_vec</span>  = <span class="var type0" id="S22T0U118">THE_SOL_VEC</span>(1:2);</span></span>
<span class="srcline"><span class="lineno"><a href="111,33" id="srcline33"> 33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">% classify the type of line</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,35" id="srcline35"> 35</a></span><span class="line"><span class="var type0" id="S8T0U125">OBJ</span>.line_type = LOC_classify_line_type(<span class="var type0" id="S23T0U129">normal_vec</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="111,36" id="srcline36"> 36</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,37" id="srcline37"> 37</a></span><span class="line"><span class="keyword">switch</span>(<span class="var type0" id="S8T0U133">OBJ</span>.line_type)</span></span>
<span class="srcline"><span class="lineno"><a href="111,38" id="srcline38"> 38</a></span><span class="line">    <span class="keyword">case</span> <span class="string">'SLOPEY'</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,39" id="srcline39"> 39</a></span><span class="line">          <span class="var type0" id="S22T0U139">THE_SOL_VEC</span> = <span class="var type0" id="S22T0U141">THE_SOL_VEC</span> / <span class="var type0" id="S22T0U143">THE_SOL_VEC</span>(2); </span></span>
<span class="srcline"><span class="lineno"><a href="111,40" id="srcline40"> 40</a></span><span class="line">    <span class="keyword">case</span> <span class="string">'VERT'</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,41" id="srcline41"> 41</a></span><span class="line">          <span class="var type0" id="S22T0U149">THE_SOL_VEC</span> = <span class="var type0" id="S22T0U151">THE_SOL_VEC</span> / <span class="var type0" id="S22T0U153">THE_SOL_VEC</span>(1); </span></span>
<span class="srcline"><span class="lineno"><a href="111,42" id="srcline42"> 42</a></span><span class="line">    <span class="keyword">case</span> <span class="string">'HORZ'</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,43" id="srcline43"> 43</a></span><span class="line">          <span class="var type0" id="S22T0U159">THE_SOL_VEC</span> = <span class="var type0" id="S22T0U161">THE_SOL_VEC</span> / <span class="var type0" id="S22T0U163">THE_SOL_VEC</span>(2); </span></span>
<span class="srcline"><span class="lineno"><a href="111,44" id="srcline44"> 44</a></span><span class="line">    <span class="keyword">otherwise</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,45" id="srcline45"> 45</a></span><span class="line">        error(<span class="string">'###_ERROR:  unknown line type'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="111,46" id="srcline46"> 46</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,47" id="srcline47"> 47</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,48" id="srcline48"> 48</a></span><span class="line"><span class="var type0" id="S8T0U173">OBJ</span>.abd_col = <span class="var type0" id="S22T0U175">THE_SOL_VEC</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="111,49" id="srcline49"> 49</a></span><span class="line"><span class="var type0" id="S8T0U179">OBJ</span>.a       = <span class="var type0" id="S22T0U182">THE_SOL_VEC</span>(1);</span></span>
<span class="srcline"><span class="lineno"><a href="111,50" id="srcline50"> 50</a></span><span class="line"><span class="var type0" id="S8T0U187">OBJ</span>.b       = <span class="var type0" id="S22T0U190">THE_SOL_VEC</span>(2);</span></span>
<span class="srcline"><span class="lineno"><a href="111,51" id="srcline51"> 51</a></span><span class="line"><span class="var type0" id="S8T0U195">OBJ</span>.d       = <span class="var type0" id="S22T0U198">THE_SOL_VEC</span>(3);</span></span>
<span class="srcline"><span class="lineno"><a href="111,52" id="srcline52"> 52</a></span><span class="line"><span class="keyword">end</span>   <span class="comment">% bh_line_homog_CLS</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,53" id="srcline53"> 53</a></span><span class="line"><span class="comment">%==========================================================================</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,54" id="srcline54"> 54</a></span><span class="line"><span class="keyword">function</span> <span class="var type0" id="S27T0U202">tf_val</span> = isVert(<span class="var type0" id="S28T0U205">OBJ</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="111,55" id="srcline55"> 55</a></span><span class="line">         <span class="var type0" id="S27T0U208">tf_val</span> = strcmp(<span class="var type0" id="S28T0U212">OBJ</span>.line_type,<span class="string">'VERT'</span>); </span></span>
<span class="srcline"><span class="lineno"><a href="111,56" id="srcline56"> 56</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,57" id="srcline57"> 57</a></span><span class="line"><span class="comment">%==========================================================================</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,58" id="srcline58"> 58</a></span><span class="line"><span class="keyword">function</span> <span class="var type0" id="S31T0U217">tf_val</span> = isHorz(<span class="var type0" id="S32T0U220">OBJ</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="111,59" id="srcline59"> 59</a></span><span class="line">         <span class="var type0" id="S31T0U223">tf_val</span> = strcmp(<span class="var type0" id="S32T0U227">OBJ</span>.line_type,<span class="string">'HORZ'</span>); </span></span>
<span class="srcline"><span class="lineno"><a href="111,60" id="srcline60"> 60</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,61" id="srcline61"> 61</a></span><span class="line"><span class="comment">%==========================================================================</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,62" id="srcline62"> 62</a></span><span class="line"><span class="keyword">function</span> [<span class="var type0" id="S35T0U232">u</span>,<span class="var type0" id="S36T0U233">v</span>] = calc_uv(<span class="var type0" id="S37T0U236">OBJ</span>,<span class="var type0" id="S38T0U237">u_meas</span>, <span class="var type0" id="S39T0U238">v_meas</span>)  </span></span>
<span class="srcline"><span class="lineno"><a href="111,63" id="srcline63"> 63</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="111,64" id="srcline64"> 64</a></span><span class="line">    <span class="var type0" id="S38T0U241">u_meas</span> = <span class="var type0" id="S38T0U243">u_meas</span>(:);</span></span>
<span class="srcline"><span class="lineno"><a href="111,65" id="srcline65"> 65</a></span><span class="line">    <span class="var type0" id="S39T0U247">v_meas</span> = <span class="var type0" id="S39T0U249">v_meas</span>(:);</span></span>
<span class="srcline"><span class="lineno"><a href="111,66" id="srcline66"> 66</a></span><span class="line">    <span class="var type0" id="S40T0U253">N</span>      = length(<span class="var type0" id="S38T0U256">u_meas</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="111,67" id="srcline67"> 67</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="111,68" id="srcline68"> 68</a></span><span class="line">    <span class="comment">% a.U + b.V + d = 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,69" id="srcline69"> 69</a></span><span class="line">    <span class="keyword">if</span>( <span class="var type0" id="S37T0U262">OBJ</span>.isVert() )</span></span>
<span class="srcline"><span class="lineno"><a href="111,70" id="srcline70"> 70</a></span><span class="line">         <span class="comment">% a.U + b.V + d = 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,71" id="srcline71"> 71</a></span><span class="line">         <span class="comment">% then we have a VERTICAL ||| line</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,72" id="srcline72"> 72</a></span><span class="line">         <span class="var type0" id="S36T0U266">v</span> = linspace(min(<span class="var type0" id="S39T0U272">v_meas</span>), max(<span class="var type0" id="S39T0U275">v_meas</span>), <span class="var type0" id="S40T0U276">N</span>)'; <span class="comment">% a COL       </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,73" id="srcline73"> 73</a></span><span class="line">         <span class="var type0" id="S35T0U279">u</span> = (-1*<span class="var type0" id="S37T0U287">OBJ</span>.d/<span class="var type0" id="S37T0U290">OBJ</span>.a)  *  ones(size(<span class="var type0" id="S36T0U296">v</span>));</span></span>
<span class="srcline"><span class="lineno"><a href="111,74" id="srcline74"> 74</a></span><span class="line">    <span class="keyword">elseif</span>(<span class="var type0" id="S37T0U301">OBJ</span>.isHorz())</span></span>
<span class="srcline"><span class="lineno"><a href="111,75" id="srcline75"> 75</a></span><span class="line">         <span class="comment">% a.U + b.V + d = 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,76" id="srcline76"> 76</a></span><span class="line">         <span class="comment">% then we have a HORIZONTAL --- line</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,77" id="srcline77"> 77</a></span><span class="line">         <span class="var type0" id="S35T0U305">u</span> = linspace(min(<span class="var type0" id="S38T0U311">u_meas</span>), max(<span class="var type0" id="S38T0U314">u_meas</span>), <span class="var type0" id="S40T0U315">N</span>)'; <span class="comment">% a COL</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,78" id="srcline78"> 78</a></span><span class="line">         <span class="var type0" id="S36T0U318">v</span> = (-<span class="var type0" id="S37T0U324">OBJ</span>.d/<span class="var type0" id="S37T0U327">OBJ</span>.b)  *  ones(size(<span class="var type0" id="S35T0U333">u</span>));</span></span>
<span class="srcline"><span class="lineno"><a href="111,79" id="srcline79"> 79</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,80" id="srcline80"> 80</a></span><span class="line">         <span class="comment">% a.U + b.V + d = 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,81" id="srcline81"> 81</a></span><span class="line">         <span class="comment">% then we have a SLOPEY ///\\\ line</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,82" id="srcline82"> 82</a></span><span class="line">         <span class="var type0" id="S35T0U337">u</span> = <span class="var type0" id="S38T0U338">u_meas</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="111,83" id="srcline83"> 83</a></span><span class="line">         <span class="var type0" id="S36T0U341">v</span> = -1*(<span class="var type0" id="S37T0U349">OBJ</span>.d + <span class="var type0" id="S37T0U353">OBJ</span>.a*<span class="var type0" id="S38T0U355">u_meas</span>)/<span class="var type0" id="S37T0U357">OBJ</span>.b;</span></span>
<span class="srcline"><span class="lineno"><a href="111,84" id="srcline84"> 84</a></span><span class="line">    <span class="keyword">end</span>  </span></span>
<span class="srcline"><span class="lineno"><a href="111,85" id="srcline85"> 85</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,86" id="srcline86"> 86</a></span><span class="line"><span class="comment">%========================================================================== </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,87" id="srcline87"> 87</a></span><span class="line"><span class="keyword">function</span> <span class="var type0" id="S48T0U361">hax</span> = plot_simple(<span class="var type0" id="S49T0U364">OBJ</span>,<span class="var type0" id="S50T0U365">u_meas</span>,<span class="var type0" id="S51T0U366">v_meas</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="111,88" id="srcline88"> 88</a></span><span class="line">    <span class="var type0" id="S48T0U369">hax</span> = [];</span></span>
<span class="srcline"><span class="lineno"><a href="111,89" id="srcline89"> 89</a></span><span class="line">    <span class="comment">% this is purely a visualization method</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,90" id="srcline90"> 90</a></span><span class="line">    <span class="comment">% so NONE of it is releveant for a CODER deployment</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,91" id="srcline91"> 91</a></span><span class="line">    <span class="keyword">if</span>(1 ==coder.target(<span class="string">'MATLAB'</span>) )</span></span>
<span class="srcline"><span class="lineno"><a href="111,92" id="srcline92"> 92</a></span><span class="line">        figure;</span></span>
<span class="srcline"><span class="lineno"><a href="111,93" id="srcline93"> 93</a></span><span class="line">        <span class="var type0" id="S48T0U387">hax</span> = axes;</span></span>
<span class="srcline"><span class="lineno"><a href="111,94" id="srcline94"> 94</a></span><span class="line">        plot(<span class="var type0" id="S48T0U393">hax</span>,<span class="var type0" id="S50T0U394">u_meas</span>,<span class="var type0" id="S51T0U395">v_meas</span>,<span class="string">'ro'</span>);  axis <span class="string">tight</span>; grid <span class="string">on</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,95" id="srcline95"> 95</a></span><span class="line">          hold <span class="string">on</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,96" id="srcline96"> 96</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,97" id="srcline97"> 97</a></span><span class="line">        [<span class="var type0" id="S59T0U409">u</span>,<span class="var type0" id="S60T0U410">v</span>] = <span class="var type0" id="S49T0U413">OBJ</span>.calc_uv(<span class="var type0" id="S50T0U415">u_meas</span>, <span class="var type0" id="S51T0U416">v_meas</span>); </span></span>
<span class="srcline"><span class="lineno"><a href="111,98" id="srcline98"> 98</a></span><span class="line">        plot(<span class="var type0" id="S48T0U420">hax</span>,<span class="var type0" id="S59T0U421">u</span>,<span class="var type0" id="S60T0U422">v</span>,<span class="string">'-b'</span>, <span class="string">'LineWidth'</span>,2);</span></span>
<span class="srcline"><span class="lineno"><a href="111,99" id="srcline99"> 99</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,100" id="srcline100">100</a></span><span class="line">        <span class="var type0" id="S61T0U428">tmp_c</span> = [<span class="string">'Line type is '</span>, char(<span class="var type0" id="S49T0U435">OBJ</span>.line_type)];</span></span>
<span class="srcline"><span class="lineno"><a href="111,101" id="srcline101">101</a></span><span class="line">        title(<span class="var type0" id="S48T0U440">hax</span>,<span class="var type0" id="S61T0U441">tmp_c</span>); </span></span>
<span class="srcline"><span class="lineno"><a href="111,102" id="srcline102">102</a></span><span class="line">        axis(<span class="var type0" id="S48T0U445">hax</span>,<span class="string">'equal'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="111,103" id="srcline103">103</a></span><span class="line">        <span class="var type0" id="S48T0U450">hax</span>.YDir = <span class="string">'reverse'</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="111,104" id="srcline104">104</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,105" id="srcline105">105</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,106" id="srcline106">106</a></span><span class="line"><span class="comment">%==========================================================================</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,107" id="srcline107">107</a></span><span class="line"><span class="keyword">function</span> [<span class="var type0" id="S65T0U455">tf_is_valid</span>, <span class="var type0" id="S66T0U456">uv_bot</span>, <span class="var type0" id="S67T0U457">uv_top</span>] = get_roi_intersection_co_ords(<span class="var type0" id="S68T0U460">OBJ</span>, <span class="var type0" id="S69T0U461">ulim</span>, <span class="var type0" id="S70T0U462">vlim</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="111,108" id="srcline108">108</a></span><span class="line">         [<span class="var type0" id="S65T0U466">tf_is_valid</span>, <span class="var type0" id="S66T0U467">uv_bot</span>, <span class="var type0" id="S67T0U468">uv_top</span>] = LOC_get_roi_intersection_co_ords(<span class="var type0" id="S68T0U471">OBJ</span>, <span class="var type0" id="S69T0U472">ulim</span>, <span class="var type0" id="S70T0U473">vlim</span>); </span></span>
<span class="srcline"><span class="lineno"><a href="111,109" id="srcline109">109</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,110" id="srcline110">110</a></span><span class="line"><span class="comment">%==========================================================================</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,111" id="srcline111">111</a></span><span class="line"><span class="keyword">function</span> plot_intersection(<span class="var type0" id="S73T0U478">OBJ</span>, <span class="var type0" id="S74T0U479">hax</span>, <span class="var type0" id="S75T0U480">color_char</span>, <span class="var type0" id="S76T0U481">ulim</span>, <span class="var type0" id="S77T0U482">vlim</span>, <span class="var type0" id="S78T0U483">tf_plot_roi</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="111,112" id="srcline112">112</a></span><span class="line">    <span class="comment">% this is purely a visualization method</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,113" id="srcline113">113</a></span><span class="line">    <span class="comment">% so NONE of it is releveant for a CODER deployment</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,114" id="srcline114">114</a></span><span class="line">    <span class="keyword">if</span>(1 ==coder.target(<span class="string">'MATLAB'</span>) )</span></span>
<span class="srcline"><span class="lineno"><a href="111,115" id="srcline115">115</a></span><span class="line">           <span class="keyword">if</span>(isempty(<span class="var type0" id="S74T0U499">hax</span>))</span></span>
<span class="srcline"><span class="lineno"><a href="111,116" id="srcline116">116</a></span><span class="line">               figure;</span></span>
<span class="srcline"><span class="lineno"><a href="111,117" id="srcline117">117</a></span><span class="line">               <span class="var type0" id="S74T0U505">hax</span> = axes();</span></span>
<span class="srcline"><span class="lineno"><a href="111,118" id="srcline118">118</a></span><span class="line">               axis(<span class="var type0" id="S74T0U511">hax</span>,<span class="string">'equal'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="111,119" id="srcline119">119</a></span><span class="line">               <span class="var type0" id="S74T0U516">hax</span>.YDir = <span class="string">'reverse'</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="111,120" id="srcline120">120</a></span><span class="line">           <span class="keyword">end</span>    </span></span>
<span class="srcline"><span class="lineno"><a href="111,121" id="srcline121">121</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,122" id="srcline122">122</a></span><span class="line">           <span class="keyword">if</span>( true==<span class="var type0" id="S78T0U525">tf_plot_roi</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="111,123" id="srcline123">123</a></span><span class="line">               <span class="var type0" id="S85T0U528">u</span> = [<span class="var type0" id="S76T0U532">ulim</span>(1), <span class="var type0" id="S76T0U535">ulim</span>(2), <span class="var type0" id="S76T0U538">ulim</span>(2), <span class="var type0" id="S76T0U541">ulim</span>(1), <span class="var type0" id="S76T0U544">ulim</span>(1)];</span></span>
<span class="srcline"><span class="lineno"><a href="111,124" id="srcline124">124</a></span><span class="line">               <span class="var type0" id="S86T0U548">v</span> = [<span class="var type0" id="S77T0U552">vlim</span>(1), <span class="var type0" id="S77T0U555">vlim</span>(1), <span class="var type0" id="S77T0U558">vlim</span>(2), <span class="var type0" id="S77T0U561">vlim</span>(2), <span class="var type0" id="S77T0U564">vlim</span>(1)];</span></span>
<span class="srcline"><span class="lineno"><a href="111,125" id="srcline125">125</a></span><span class="line">               <span class="comment">%plot(hax,u,v,'-m','LineWidth',2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,126" id="srcline126">126</a></span><span class="line">               <span class="var type0" id="S87T0U568">hL</span> = line(<span class="var type0" id="S74T0U571">hax</span>,<span class="string">'XData'</span>,<span class="var type0" id="S85T0U573">u</span>,<span class="string">'YData'</span>,<span class="var type0" id="S86T0U575">v</span>,<span class="string">'Color'</span>,<span class="string">'m'</span>,<span class="string">'LineStyle'</span>,<span class="string">'-'</span>,<span class="string">'LineWidth'</span>,2);</span></span>
<span class="srcline"><span class="lineno"><a href="111,127" id="srcline127">127</a></span><span class="line">           <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,128" id="srcline128">128</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,129" id="srcline129">129</a></span><span class="line">           [<span class="var type0" id="S89T0U585">tf_is_valid</span>, <span class="var type0" id="S90T0U586">uv_bot</span>, <span class="var type0" id="S91T0U587">uv_top</span>] = get_roi_intersection_co_ords(<span class="var type0" id="S73T0U590">OBJ</span>, <span class="var type0" id="S76T0U591">ulim</span>, <span class="var type0" id="S77T0U592">vlim</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="111,130" id="srcline130">130</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,131" id="srcline131">131</a></span><span class="line">           <span class="keyword">if</span>(false==<span class="var type0" id="S89T0U599">tf_is_valid</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="111,132" id="srcline132">132</a></span><span class="line">               <span class="keyword">return</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,133" id="srcline133">133</a></span><span class="line">           <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,134" id="srcline134">134</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,135" id="srcline135">135</a></span><span class="line">           <span class="var type0" id="S85T0U603">u</span> = [<span class="var type0" id="S90T0U607">uv_bot</span>(1),<span class="var type0" id="S91T0U610">uv_top</span>(1)];</span></span>
<span class="srcline"><span class="lineno"><a href="111,136" id="srcline136">136</a></span><span class="line">           <span class="var type0" id="S86T0U614">v</span> = [<span class="var type0" id="S90T0U618">uv_bot</span>(2),<span class="var type0" id="S91T0U621">uv_top</span>(2)];</span></span>
<span class="srcline"><span class="lineno"><a href="111,137" id="srcline137">137</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,138" id="srcline138">138</a></span><span class="line">           <span class="comment">% plot the line   </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,139" id="srcline139">139</a></span><span class="line">           <span class="var type0" id="S87T0U625">hL</span> = line(<span class="var type0" id="S74T0U628">hax</span>,<span class="string">'XData'</span>,<span class="var type0" id="S85T0U630">u</span>,<span class="string">'YData'</span>,<span class="var type0" id="S86T0U632">v</span>,<span class="string">'Color'</span>,<span class="var type0" id="S75T0U634">color_char</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,140" id="srcline140">140</a></span><span class="line">                     <span class="string">'LineStyle'</span>,<span class="string">'-'</span>,<span class="string">'LineWidth'</span>,2 );</span></span>
<span class="srcline"><span class="lineno"><a href="111,141" id="srcline141">141</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,142" id="srcline142">142</a></span><span class="line">           <span class="comment">% plot an o for the TOP point</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,143" id="srcline143">143</a></span><span class="line">           line(<span class="var type0" id="S74T0U642">hax</span>,<span class="string">'XData'</span>,<span class="var type0" id="S91T0U645">uv_top</span>(1),<span class="string">'YData'</span>,<span class="var type0" id="S91T0U649">uv_top</span>(2),<span class="string">'Color'</span>,<span class="var type0" id="S75T0U652">color_char</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,144" id="srcline144">144</a></span><span class="line">                     <span class="string">'Marker'</span>, <span class="string">'o'</span>, <span class="string">'MarkerSize'</span>,10,<span class="string">'MarkerfaceColor'</span>,<span class="var type0" id="S75T0U658">color_char</span>); </span></span>
<span class="srcline"><span class="lineno"><a href="111,145" id="srcline145">145</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,146" id="srcline146">146</a></span><span class="line">           <span class="comment">% plot an o for the BOT point      </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,147" id="srcline147">147</a></span><span class="line">           line(<span class="var type0" id="S74T0U662">hax</span>,<span class="string">'XData'</span>,<span class="var type0" id="S90T0U665">uv_bot</span>(1),<span class="string">'YData'</span>,<span class="var type0" id="S90T0U669">uv_bot</span>(2),<span class="string">'Color'</span>,<span class="var type0" id="S75T0U672">color_char</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,148" id="srcline148">148</a></span><span class="line">                     <span class="string">'Marker'</span>, <span class="string">'s'</span>, <span class="string">'MarkerSize'</span>,10,<span class="string">'MarkerfaceColor'</span>,<span class="var type0" id="S75T0U678">color_char</span>); </span></span>
<span class="srcline"><span class="lineno"><a href="111,149" id="srcline149">149</a></span><span class="line">    <span class="keyword">end</span>         </span></span>
<span class="srcline"><span class="lineno"><a href="111,150" id="srcline150">150</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,151" id="srcline151">151</a></span><span class="line"><span class="comment">%==========================================================================</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,152" id="srcline152">152</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,153" id="srcline153">153</a></span><span class="line"><span class="keyword">end</span> <span class="comment">% methods</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,154" id="srcline154">154</a></span><span class="line"><span class="comment">%==========================================================================</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,155" id="srcline155">155</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="111,156" id="srcline156">156</a></span><span class="line"><span class="keyword">end</span> <span class="comment">% classdef</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,157" id="srcline157">157</a></span><span class="line"><span class="comment">%_#########################################################################</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,158" id="srcline158">158</a></span><span class="line"><span class="comment">% Local HELPER functions</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,159" id="srcline159">159</a></span><span class="line"><span class="comment">%_#########################################################################</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,160" id="srcline160">160</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,161" id="srcline161">161</a></span><span class="line"><span class="keyword">function</span> <span class="var type0" id="S95T0U681">a_str</span> = LOC_classify_line_type(<span class="var type0" id="S96T0U684">normal_vec</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="111,162" id="srcline162">162</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,163" id="srcline163">163</a></span><span class="line">    <span class="var type0" id="S96T0U687">normal_vec</span> = <span class="var type0" id="S96T0U689">normal_vec</span> / norm(<span class="var type0" id="S96T0U692">normal_vec</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="111,164" id="srcline164">164</a></span><span class="line">    <span class="var type0" id="S98T0U695">Y</span>          = <span class="var type0" id="S96T0U697">normal_vec</span>(2); <span class="comment">% V</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,165" id="srcline165">165</a></span><span class="line">    <span class="var type0" id="S99T0U701">X</span>          = <span class="var type0" id="S96T0U703">normal_vec</span>(1); <span class="comment">% U</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,166" id="srcline166">166</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="111,167" id="srcline167">167</a></span><span class="line">    <span class="var type0" id="S100T0U707">theta_rad</span>  = atan2(<span class="var type0" id="S98T0U710">Y</span>,<span class="var type0" id="S99T0U711">X</span>);          <span class="comment">% [-pi , pi]</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,168" id="srcline168">168</a></span><span class="line">    <span class="var type0" id="S102T0U714">theta_deg</span>  = <span class="var type0" id="S100T0U717">theta_rad</span> * 180/pi;  <span class="comment">% [-180, 180]</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,169" id="srcline169">169</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,170" id="srcline170">170</a></span><span class="line">    <span class="comment">% convert angle from [-180,180] to [0, 360]</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,171" id="srcline171">171</a></span><span class="line">    <span class="keyword">if</span>(<span class="var type0" id="S102T0U725">theta_deg</span>&lt;0)</span></span>
<span class="srcline"><span class="lineno"><a href="111,172" id="srcline172">172</a></span><span class="line">        <span class="var type0" id="S102T0U729">theta_deg</span> = 360 + <span class="var type0" id="S102T0U732">theta_deg</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="111,173" id="srcline173">173</a></span><span class="line">    <span class="keyword">end</span>    </span></span>
<span class="srcline"><span class="lineno"><a href="111,174" id="srcline174">174</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,175" id="srcline175">175</a></span><span class="line">    <span class="comment">% first categorise the NORMAL to the line</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,176" id="srcline176">176</a></span><span class="line">    <span class="var type0" id="S104T0U735">tf_the_normal_is_horz</span> = false;</span></span>
<span class="srcline"><span class="lineno"><a href="111,177" id="srcline177">177</a></span><span class="line">    <span class="var type0" id="S106T0U740">tf_the_normal_is_vert</span> = false;</span></span>
<span class="srcline"><span class="lineno"><a href="111,178" id="srcline178">178</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,179" id="srcline179">179</a></span><span class="line">    <span class="comment">%  so we have   0 &lt;= theta_deg &lt;= 360</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,180" id="srcline180">180</a></span><span class="line">    <span class="var type0" id="S107T0U745">TOL_DEG</span> = 2; <span class="comment">% a tolerence</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,181" id="srcline181">181</a></span><span class="line">    <span class="keyword">if</span>(      (<span class="var type0" id="S102T0U754">theta_deg</span> &lt;= <span class="var type0" id="S107T0U755">TOL_DEG</span>       )   || <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,182" id="srcline182">182</a></span><span class="line">             (<span class="var type0" id="S102T0U758">theta_deg</span> &gt;= (360-<span class="var type0" id="S107T0U762">TOL_DEG</span>) )   || <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,183" id="srcline183">183</a></span><span class="line">         (   (<span class="var type0" id="S102T0U767">theta_deg</span> &gt;= (180-<span class="var type0" id="S107T0U771">TOL_DEG</span>) )   &amp;&amp; <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,184" id="srcline184">184</a></span><span class="line">             (<span class="var type0" id="S102T0U774">theta_deg</span> &lt;= (180+<span class="var type0" id="S107T0U778">TOL_DEG</span>) )   ) <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,185" id="srcline185">185</a></span><span class="line">       )</span></span>
<span class="srcline"><span class="lineno"><a href="111,186" id="srcline186">186</a></span><span class="line">           <span class="var type0" id="S104T0U781">tf_the_normal_is_horz</span> = true;</span></span>
<span class="srcline"><span class="lineno"><a href="111,187" id="srcline187">187</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,188" id="srcline188">188</a></span><span class="line">    <span class="keyword">elseif</span>(    (<span class="var type0" id="S102T0U790">theta_deg</span> &gt;= (90-<span class="var type0" id="S107T0U794">TOL_DEG</span>)  &amp;&amp; (<span class="var type0" id="S102T0U797">theta_deg</span> &lt;= (90+<span class="var type0" id="S107T0U801">TOL_DEG</span>))) || <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,189" id="srcline189">189</a></span><span class="line">               (<span class="var type0" id="S102T0U805">theta_deg</span> &gt;= (270-<span class="var type0" id="S107T0U809">TOL_DEG</span>) &amp;&amp; (<span class="var type0" id="S102T0U812">theta_deg</span> &lt;= (270+<span class="var type0" id="S107T0U816">TOL_DEG</span>))) <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,190" id="srcline190">190</a></span><span class="line">          )</span></span>
<span class="srcline"><span class="lineno"><a href="111,191" id="srcline191">191</a></span><span class="line">           <span class="var type0" id="S106T0U819">tf_the_normal_is_vert</span> = true;</span></span>
<span class="srcline"><span class="lineno"><a href="111,192" id="srcline192">192</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,193" id="srcline193">193</a></span><span class="line">           <span class="comment">% do NOTHING</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,194" id="srcline194">194</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,195" id="srcline195">195</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,196" id="srcline196">196</a></span><span class="line">    <span class="comment">% OK: so we know the orientation of the NORMAL vector</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,197" id="srcline197">197</a></span><span class="line">    <span class="comment">%     now we can classify the actual LINE</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,198" id="srcline198">198</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,199" id="srcline199">199</a></span><span class="line">    <span class="keyword">if</span>(true==<span class="var type0" id="S104T0U829">tf_the_normal_is_horz</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="111,200" id="srcline200">200</a></span><span class="line">            <span class="var type0" id="S95T0U832">a_str</span> = <span class="string">'VERT'</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="111,201" id="srcline201">201</a></span><span class="line">    <span class="keyword">elseif</span>(true==<span class="var type0" id="S106T0U839">tf_the_normal_is_vert</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="111,202" id="srcline202">202</a></span><span class="line">           <span class="var type0" id="S95T0U842">a_str</span> = <span class="string">'HORZ'</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="111,203" id="srcline203">203</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,204" id="srcline204">204</a></span><span class="line">           <span class="var type0" id="S95T0U847">a_str</span> = <span class="string">'SLOPEY'</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="111,205" id="srcline205">205</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,206" id="srcline206">206</a></span><span class="line"><span class="keyword">end</span> <span class="comment">%LOC_classify_line_type</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,207" id="srcline207">207</a></span><span class="line"><span class="comment">%==========================================================================</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,208" id="srcline208">208</a></span><span class="line"><span class="keyword">function</span> [<span class="var type0" id="S110T0U851">tf_is_valid</span>, <span class="var type0" id="S111T0U852">uv_bot</span>, <span class="var type0" id="S112T0U853">uv_top</span>] = LOC_get_roi_intersection_co_ords(<span class="var type0" id="S113T0U856">OBJ</span>, <span class="var type0" id="S114T0U857">ulim</span>, <span class="var type0" id="S115T0U858">vlim</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="111,209" id="srcline209">209</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="111,210" id="srcline210">210</a></span><span class="line"><span class="keyword">if</span>(1 == coder.target(<span class="string">'MATLAB'</span>) )</span></span>
<span class="srcline"><span class="lineno"><a href="111,211" id="srcline211">211</a></span><span class="line">    validateattributes(<span class="var type0" id="S114T0U872">ulim</span>,{<span class="string">'numeric'</span>},{<span class="string">'vector'</span>,<span class="string">'numel'</span>,2});</span></span>
<span class="srcline"><span class="lineno"><a href="111,212" id="srcline212">212</a></span><span class="line">    validateattributes(<span class="var type0" id="S114T0U884">ulim</span>,{<span class="string">'numeric'</span>},{<span class="string">'vector'</span>,<span class="string">'numel'</span>,2});</span></span>
<span class="srcline"><span class="lineno"><a href="111,213" id="srcline213">213</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,214" id="srcline214">214</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,215" id="srcline215">215</a></span><span class="line">    <span class="var type0" id="S110T0U895">tf_is_valid</span> = false;    </span></span>
<span class="srcline"><span class="lineno"><a href="111,216" id="srcline216">216</a></span><span class="line">    <span class="var type0" id="S111T0U900">uv_bot</span> = [NaN;NaN];</span></span>
<span class="srcline"><span class="lineno"><a href="111,217" id="srcline217">217</a></span><span class="line">    <span class="var type0" id="S112T0U910">uv_top</span> = [NaN;NaN];</span></span>
<span class="srcline"><span class="lineno"><a href="111,218" id="srcline218">218</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,219" id="srcline219">219</a></span><span class="line">    <span class="keyword">switch</span>(<span class="var type0" id="S113T0U921">OBJ</span>.line_type)</span></span>
<span class="srcline"><span class="lineno"><a href="111,220" id="srcline220">220</a></span><span class="line">        <span class="keyword">case</span> <span class="string">'VERT'</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,221" id="srcline221">221</a></span><span class="line">             <span class="var type0" id="S120T0U927">u</span> = (-1*<span class="var type0" id="S113T0U934">OBJ</span>.d/<span class="var type0" id="S113T0U937">OBJ</span>.a);</span></span>
<span class="srcline"><span class="lineno"><a href="111,222" id="srcline222">222</a></span><span class="line">             <span class="keyword">if</span>( (<span class="var type0" id="S120T0U945">u</span> &lt;= <span class="var type0" id="S114T0U947">ulim</span>(2)) &amp;&amp; (<span class="var type0" id="S120T0U951">u</span>&gt;=<span class="var type0" id="S114T0U953">ulim</span>(1)) )</span></span>
<span class="srcline"><span class="lineno"><a href="111,223" id="srcline223">223</a></span><span class="line">                  <span class="var type0" id="S111T0U957">uv_bot</span> = [<span class="var type0" id="S120T0U960">u</span>;<span class="var type0" id="S115T0U963">vlim</span>(2)];</span></span>
<span class="srcline"><span class="lineno"><a href="111,224" id="srcline224">224</a></span><span class="line">                  <span class="var type0" id="S112T0U967">uv_top</span> = [<span class="var type0" id="S120T0U970">u</span>;<span class="var type0" id="S115T0U973">vlim</span>(1)];</span></span>
<span class="srcline"><span class="lineno"><a href="111,225" id="srcline225">225</a></span><span class="line">                  <span class="var type0" id="S110T0U977">tf_is_valid</span> = true;    </span></span>
<span class="srcline"><span class="lineno"><a href="111,226" id="srcline226">226</a></span><span class="line">             <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,227" id="srcline227">227</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,228" id="srcline228">228</a></span><span class="line">             <span class="keyword">return</span> <span class="comment">% RETURN</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,229" id="srcline229">229</a></span><span class="line">        <span class="keyword">case</span> <span class="string">'HORZ'</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,230" id="srcline230">230</a></span><span class="line">             <span class="var type0" id="S122T0U985">v</span> = (-<span class="var type0" id="S113T0U990">OBJ</span>.d/<span class="var type0" id="S113T0U993">OBJ</span>.b);</span></span>
<span class="srcline"><span class="lineno"><a href="111,231" id="srcline231">231</a></span><span class="line">             <span class="keyword">if</span>( (<span class="var type0" id="S122T0U1001">v</span> &lt;= <span class="var type0" id="S115T0U1003">vlim</span>(2)) &amp;&amp; (<span class="var type0" id="S122T0U1007">v</span>&gt;=<span class="var type0" id="S115T0U1009">vlim</span>(1)) )</span></span>
<span class="srcline"><span class="lineno"><a href="111,232" id="srcline232">232</a></span><span class="line">                  <span class="var type0" id="S111T0U1013">uv_bot</span> = [<span class="var type0" id="S114T0U1017">ulim</span>(1);<span class="var type0" id="S122T0U1020">v</span>];</span></span>
<span class="srcline"><span class="lineno"><a href="111,233" id="srcline233">233</a></span><span class="line">                  <span class="var type0" id="S112T0U1023">uv_top</span> = [<span class="var type0" id="S114T0U1027">ulim</span>(2);<span class="var type0" id="S122T0U1030">v</span>];</span></span>
<span class="srcline"><span class="lineno"><a href="111,234" id="srcline234">234</a></span><span class="line">                  <span class="var type0" id="S110T0U1033">tf_is_valid</span> = true;    </span></span>
<span class="srcline"><span class="lineno"><a href="111,235" id="srcline235">235</a></span><span class="line">             <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,236" id="srcline236">236</a></span><span class="line">             <span class="keyword">return</span> <span class="comment">% RETURN</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,237" id="srcline237">237</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,238" id="srcline238">238</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,239" id="srcline239">239</a></span><span class="line">    <span class="comment">% so if we made it to here then we have a SLOPEY line</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,240" id="srcline240">240</a></span><span class="line">    <span class="comment">%  a.U + b.V + d = 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,241" id="srcline241">241</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,242" id="srcline242">242</a></span><span class="line">    <span class="var type0" id="S123T0U1039">my_Vf</span> = @(U) (-1*(<span class="var type0" id="S113T0U1050">OBJ</span>.d + <span class="var type0" id="S113T0U1054">OBJ</span>.a*U)/<span class="var type0" id="S113T0U1058">OBJ</span>.b);</span></span>
<span class="srcline"><span class="lineno"><a href="111,243" id="srcline243">243</a></span><span class="line">    <span class="var type0" id="S124T0U1062">my_Uf</span> = @(V) (-1*(<span class="var type0" id="S113T0U1073">OBJ</span>.d + <span class="var type0" id="S113T0U1077">OBJ</span>.b*V)/<span class="var type0" id="S113T0U1081">OBJ</span>.a);</span></span>
<span class="srcline"><span class="lineno"><a href="111,244" id="srcline244">244</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,245" id="srcline245">245</a></span><span class="line">    [<span class="var type0" id="S125T0U1086">tf_west</span>,  <span class="var type0" id="S126T0U1087">UV_west</span> ] = LOC_get_side_intersect_point(<span class="string">'WEST'</span>,  <span class="var type0" id="S123T0U1091">my_Vf</span>, <span class="var type0" id="S124T0U1092">my_Uf</span>, <span class="var type0" id="S114T0U1093">ulim</span>, <span class="var type0" id="S115T0U1094">vlim</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="111,246" id="srcline246">246</a></span><span class="line">    [<span class="var type0" id="S128T0U1098">tf_east</span>,  <span class="var type0" id="S129T0U1099">UV_east</span> ] = LOC_get_side_intersect_point(<span class="string">'EAST'</span>,  <span class="var type0" id="S123T0U1103">my_Vf</span>, <span class="var type0" id="S124T0U1104">my_Uf</span>, <span class="var type0" id="S114T0U1105">ulim</span>, <span class="var type0" id="S115T0U1106">vlim</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="111,247" id="srcline247">247</a></span><span class="line">    [<span class="var type0" id="S130T0U1110">tf_north</span>, <span class="var type0" id="S131T0U1111">UV_north</span>] = LOC_get_side_intersect_point(<span class="string">'NORTH'</span>, <span class="var type0" id="S123T0U1115">my_Vf</span>, <span class="var type0" id="S124T0U1116">my_Uf</span>, <span class="var type0" id="S114T0U1117">ulim</span>, <span class="var type0" id="S115T0U1118">vlim</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="111,248" id="srcline248">248</a></span><span class="line">    [<span class="var type0" id="S132T0U1122">tf_south</span>, <span class="var type0" id="S133T0U1123">UV_south</span>] = LOC_get_side_intersect_point(<span class="string">'SOUTH'</span>, <span class="var type0" id="S123T0U1127">my_Vf</span>, <span class="var type0" id="S124T0U1128">my_Uf</span>, <span class="var type0" id="S114T0U1129">ulim</span>, <span class="var type0" id="S115T0U1130">vlim</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="111,249" id="srcline249">249</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,250" id="srcline250">250</a></span><span class="line">    <span class="var type0" id="S134T0U1133">the_tf_mat</span> = [<span class="var type0" id="S125T0U1136">tf_west</span>, <span class="var type0" id="S128T0U1137">tf_east</span>, <span class="var type0" id="S130T0U1138">tf_north</span>, <span class="var type0" id="S132T0U1139">tf_south</span>];</span></span>
<span class="srcline"><span class="lineno"><a href="111,251" id="srcline251">251</a></span><span class="line">    <span class="var type0" id="S135T0U1142">the_UV_mat</span> = [<span class="var type0" id="S126T0U1145">UV_west</span>, <span class="var type0" id="S129T0U1146">UV_east</span>, <span class="var type0" id="S131T0U1147">UV_north</span>, <span class="var type0" id="S133T0U1148">UV_south</span>];</span></span>
<span class="srcline"><span class="lineno"><a href="111,252" id="srcline252">252</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,253" id="srcline253">253</a></span><span class="line">    <span class="keyword">if</span>(2 ~= nnz(<span class="var type0" id="S134T0U1156">the_tf_mat</span>) )</span></span>
<span class="srcline"><span class="lineno"><a href="111,254" id="srcline254">254</a></span><span class="line">       <span class="keyword">return</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,255" id="srcline255">255</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,256" id="srcline256">256</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,257" id="srcline257">257</a></span><span class="line">    <span class="comment">% OK: so our line has intersected our ROI box</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,258" id="srcline258">258</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,259" id="srcline259">259</a></span><span class="line">    <span class="var type0" id="S137T0U1160">THE_SOL_UV_mat</span> = <span class="var type0" id="S135T0U1162">the_UV_mat</span>(:,<span class="var type0" id="S134T0U1164">the_tf_mat</span> ); </span></span>
<span class="srcline"><span class="lineno"><a href="111,260" id="srcline260">260</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,261" id="srcline261">261</a></span><span class="line">    <span class="var type0" id="S138T0U1167">UV_A</span> = <span class="var type0" id="S137T0U1169">THE_SOL_UV_mat</span>(:,1);</span></span>
<span class="srcline"><span class="lineno"><a href="111,262" id="srcline262">262</a></span><span class="line">    <span class="var type0" id="S139T0U1174">UV_B</span> = <span class="var type0" id="S137T0U1176">THE_SOL_UV_mat</span>(:,2);</span></span>
<span class="srcline"><span class="lineno"><a href="111,263" id="srcline263">263</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,264" id="srcline264">264</a></span><span class="line">    <span class="keyword">if</span>( <span class="var type0" id="S138T0U1184">UV_A</span>(2) &gt; <span class="var type0" id="S139T0U1187">UV_B</span>(2))</span></span>
<span class="srcline"><span class="lineno"><a href="111,265" id="srcline265">265</a></span><span class="line">        <span class="var type0" id="S111T0U1191">uv_bot</span> = <span class="var type0" id="S138T0U1192">UV_A</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="111,266" id="srcline266">266</a></span><span class="line">        <span class="var type0" id="S112T0U1195">uv_top</span> = <span class="var type0" id="S139T0U1196">UV_B</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="111,267" id="srcline267">267</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,268" id="srcline268">268</a></span><span class="line">        <span class="var type0" id="S111T0U1200">uv_bot</span> = <span class="var type0" id="S139T0U1201">UV_B</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="111,269" id="srcline269">269</a></span><span class="line">        <span class="var type0" id="S112T0U1204">uv_top</span> = <span class="var type0" id="S138T0U1205">UV_A</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="111,270" id="srcline270">270</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,271" id="srcline271">271</a></span><span class="line">    <span class="var type0" id="S110T0U1208">tf_is_valid</span> = true;    </span></span>
<span class="srcline"><span class="lineno"><a href="111,272" id="srcline272">272</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,273" id="srcline273">273</a></span><span class="line"><span class="keyword">end</span> <span class="comment">% LOC_get_roi_intersection_co_ords()</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,274" id="srcline274">274</a></span><span class="line"><span class="comment">%==========================================================================</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,275" id="srcline275">275</a></span><span class="line"><span class="keyword">function</span> <span class="var type0" id="S141T0U1213">tf_val</span> = LOC_UV_is_in_box(<span class="var type0" id="S142T0U1216">UV</span>, <span class="var type0" id="S143T0U1217">ulim</span>, <span class="var type0" id="S144T0U1218">vlim</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="111,276" id="srcline276">276</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,277" id="srcline277">277</a></span><span class="line">    <span class="var type0" id="S141T0U1221">tf_val</span> = false;</span></span>
<span class="srcline"><span class="lineno"><a href="111,278" id="srcline278">278</a></span><span class="line">    <span class="var type0" id="S146T0U1226">u</span>      = <span class="var type0" id="S142T0U1228">UV</span>(1);</span></span>
<span class="srcline"><span class="lineno"><a href="111,279" id="srcline279">279</a></span><span class="line">    <span class="var type0" id="S147T0U1232">v</span>      = <span class="var type0" id="S142T0U1234">UV</span>(2);</span></span>
<span class="srcline"><span class="lineno"><a href="111,280" id="srcline280">280</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,281" id="srcline281">281</a></span><span class="line">    <span class="keyword">if</span>( (<span class="var type0" id="S146T0U1244">u</span> &lt;= <span class="var type0" id="S143T0U1246">ulim</span>(2)) &amp;&amp; (<span class="var type0" id="S146T0U1250">u</span> &gt;= <span class="var type0" id="S143T0U1252">ulim</span>(1)) &amp;&amp; <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,282" id="srcline282">282</a></span><span class="line">        (<span class="var type0" id="S147T0U1256">v</span> &lt;= <span class="var type0" id="S144T0U1258">vlim</span>(2)) &amp;&amp; (<span class="var type0" id="S147T0U1262">v</span> &gt;= <span class="var type0" id="S144T0U1264">vlim</span>(1))   <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,283" id="srcline283">283</a></span><span class="line">       )</span></span>
<span class="srcline"><span class="lineno"><a href="111,284" id="srcline284">284</a></span><span class="line">         <span class="var type0" id="S141T0U1268">tf_val</span> = true;</span></span>
<span class="srcline"><span class="lineno"><a href="111,285" id="srcline285">285</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,286" id="srcline286">286</a></span><span class="line">         <span class="var type0" id="S141T0U1274">tf_val</span> = false;</span></span>
<span class="srcline"><span class="lineno"><a href="111,287" id="srcline287">287</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,288" id="srcline288">288</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,289" id="srcline289">289</a></span><span class="line"><span class="keyword">end</span> <span class="comment">% LOC_UV_is_in_box(()</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,290" id="srcline290">290</a></span><span class="line"><span class="comment">%==========================================================================</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,291" id="srcline291">291</a></span><span class="line"><span class="keyword">function</span> [<span class="var type0" id="S150T0U1279">tf_valid_intersection</span>, <span class="var type0" id="S151T0U1280">UV</span>] = <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,292" id="srcline292">292</a></span><span class="line">    LOC_get_side_intersect_point(<span class="var type0" id="S152T0U1283">side_str</span>, <span class="var type0" id="S153T0U1284">my_Vf</span>, <span class="var type0" id="S154T0U1285">my_Uf</span>, <span class="var type0" id="S155T0U1286">ulim</span>, <span class="var type0" id="S156T0U1287">vlim</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="111,293" id="srcline293">293</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="111,294" id="srcline294">294</a></span><span class="line">    <span class="comment">% SUMMARY:</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,295" id="srcline295">295</a></span><span class="line">    <span class="comment">%   for a specified side of an ROI box, where (if at all)</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,296" id="srcline296">296</a></span><span class="line">    <span class="comment">%   does our line intersect that side of teh ROI box</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,297" id="srcline297">297</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,298" id="srcline298">298</a></span><span class="line">    <span class="var type0" id="S151T0U1290">UV</span> = [0;0];</span></span>
<span class="srcline"><span class="lineno"><a href="111,299" id="srcline299">299</a></span><span class="line">    <span class="var type0" id="S150T0U1298">tf_valid_intersection</span> = false;</span></span>
<span class="srcline"><span class="lineno"><a href="111,300" id="srcline300">300</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="111,301" id="srcline301">301</a></span><span class="line">    <span class="comment">% assert that our side_str INPUT argument is a valid</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,302" id="srcline302">302</a></span><span class="line">    <span class="comment">%mustBeMember(side_str, ["NORTH","SOUTH","EAST","WEST"] );</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,303" id="srcline303">303</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,304" id="srcline304">304</a></span><span class="line">    <span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,305" id="srcline305">305</a></span><span class="line">    <span class="comment">%          0------------------------------&gt; U</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,306" id="srcline306">306</a></span><span class="line">    <span class="comment">%          |</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,307" id="srcline307">307</a></span><span class="line">    <span class="comment">%          |               NORTH</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,308" id="srcline308">308</a></span><span class="line">    <span class="comment">%          |           *-------------*</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,309" id="srcline309">309</a></span><span class="line">    <span class="comment">%          |          |              |</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,310" id="srcline310">310</a></span><span class="line">    <span class="comment">%          |          |              |</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,311" id="srcline311">311</a></span><span class="line">    <span class="comment">%          |    WEST  |              |  EAST</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,312" id="srcline312">312</a></span><span class="line">    <span class="comment">%          |          |              | </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,313" id="srcline313">313</a></span><span class="line">    <span class="comment">%          |          |              |</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,314" id="srcline314">314</a></span><span class="line">    <span class="comment">%          |          *--------------*</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,315" id="srcline315">315</a></span><span class="line">    <span class="comment">%          |               SOUTH    </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,316" id="srcline316">316</a></span><span class="line">    <span class="comment">%      V   V   </span></span></span>
<span class="srcline"><span class="lineno"><a href="111,317" id="srcline317">317</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,318" id="srcline318">318</a></span><span class="line">    <span class="var type0" id="S158T0U1303">FH_in_V_zone</span> = <span class="mxinfo " id="T15:U1">@(<span class="mxinfo " id="T3:U2">V</span>) ( <span class="mxinfo " id="T5:U3">(<span class="mxinfo " id="T5:U4"><span class="mxinfo " id="T3:U5">V</span> &lt;= <span class="mxinfo " id="T3:U6"><span class="var type1" id="S156T6U1312">vlim</span>(<span class="mxinfo " id="T3:U8">2</span>)</span></span>) &amp; (<span class="mxinfo " id="T5:U9"><span class="mxinfo " id="T3:U10">V</span> &gt;= <span class="mxinfo " id="T3:U11"><span class="var type1" id="S156T6U1318">vlim</span>(<span class="mxinfo " id="T3:U13">1</span>)</span></span>)</span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="111,319" id="srcline319">319</a></span><span class="line">    <span class="var type0" id="S159T0U1322">FH_in_U_zone</span> = @(U) ( (U &lt;= <span class="var type0" id="S155T0U1331">ulim</span>(2)) &amp; (U &gt;= <span class="var type0" id="S155T0U1337">ulim</span>(1)) );</span></span>
<span class="srcline"><span class="lineno"><a href="111,320" id="srcline320">320</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,321" id="srcline321">321</a></span><span class="line">    <span class="keyword">switch</span>(<span class="var type0" id="S152T0U1341">side_str</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="111,322" id="srcline322">322</a></span><span class="line">        <span class="keyword">case</span> <span class="string">'WEST'</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,323" id="srcline323">323</a></span><span class="line">                   <span class="var type0" id="S160T0U1346">u</span> = <span class="var type0" id="S155T0U1348">ulim</span>(1);  <span class="var type0" id="S161T0U1352">v</span> = <span class="var type0" id="S153T0U1354">my_Vf</span>(<span class="var type0" id="S160T0U1355">u</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="111,324" id="srcline324">324</a></span><span class="line">                   <span class="var type0" id="S151T0U1358">UV</span> = [<span class="var type0" id="S160T0U1361">u</span>;<span class="var type0" id="S161T0U1363">v</span>];</span></span>
<span class="srcline"><span class="lineno"><a href="111,325" id="srcline325">325</a></span><span class="line">                   <span class="keyword">if</span>( <span class="var type0" id="S158T0U1368">FH_in_V_zone</span>(<span class="var type0" id="S161T0U1369">v</span>) )</span></span>
<span class="srcline"><span class="lineno"><a href="111,326" id="srcline326">326</a></span><span class="line">                       <span class="var type0" id="S150T0U1372">tf_valid_intersection</span> = true;</span></span>
<span class="srcline"><span class="lineno"><a href="111,327" id="srcline327">327</a></span><span class="line">                   <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,328" id="srcline328">328</a></span><span class="line">        <span class="keyword">case</span> <span class="string">'EAST'</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,329" id="srcline329">329</a></span><span class="line">                   <span class="var type0" id="S160T0U1379">u</span> = <span class="var type0" id="S155T0U1381">ulim</span>(2);  <span class="var type0" id="S161T0U1385">v</span> = <span class="var type0" id="S153T0U1387">my_Vf</span>(<span class="var type0" id="S160T0U1388">u</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="111,330" id="srcline330">330</a></span><span class="line">                   <span class="var type0" id="S151T0U1391">UV</span> = [<span class="var type0" id="S160T0U1394">u</span>;<span class="var type0" id="S161T0U1396">v</span>];</span></span>
<span class="srcline"><span class="lineno"><a href="111,331" id="srcline331">331</a></span><span class="line">                   <span class="keyword">if</span>( <span class="var type0" id="S158T0U1401">FH_in_V_zone</span>(<span class="var type0" id="S161T0U1402">v</span>) )</span></span>
<span class="srcline"><span class="lineno"><a href="111,332" id="srcline332">332</a></span><span class="line">                       <span class="var type0" id="S150T0U1405">tf_valid_intersection</span> = true;</span></span>
<span class="srcline"><span class="lineno"><a href="111,333" id="srcline333">333</a></span><span class="line">                   <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,334" id="srcline334">334</a></span><span class="line">        <span class="keyword">case</span> <span class="string">'NORTH'</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,335" id="srcline335">335</a></span><span class="line">                   <span class="var type0" id="S161T0U1412">v</span> = <span class="var type0" id="S156T0U1414">vlim</span>(1);  <span class="var type0" id="S160T0U1418">u</span> = <span class="var type0" id="S154T0U1420">my_Uf</span>(<span class="var type0" id="S161T0U1421">v</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="111,336" id="srcline336">336</a></span><span class="line">                   <span class="var type0" id="S151T0U1424">UV</span> = [<span class="var type0" id="S160T0U1427">u</span>;<span class="var type0" id="S161T0U1429">v</span>];</span></span>
<span class="srcline"><span class="lineno"><a href="111,337" id="srcline337">337</a></span><span class="line">                   <span class="keyword">if</span>( <span class="var type0" id="S159T0U1434">FH_in_U_zone</span>(<span class="var type0" id="S160T0U1435">u</span>) )</span></span>
<span class="srcline"><span class="lineno"><a href="111,338" id="srcline338">338</a></span><span class="line">                       <span class="var type0" id="S150T0U1438">tf_valid_intersection</span> = true;</span></span>
<span class="srcline"><span class="lineno"><a href="111,339" id="srcline339">339</a></span><span class="line">                   <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,340" id="srcline340">340</a></span><span class="line">        <span class="keyword">case</span> <span class="string">'SOUTH'</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,341" id="srcline341">341</a></span><span class="line">                   <span class="var type0" id="S161T0U1445">v</span> = <span class="var type0" id="S156T0U1447">vlim</span>(2);  <span class="var type0" id="S160T0U1451">u</span> = <span class="var type0" id="S154T0U1453">my_Uf</span>(<span class="var type0" id="S161T0U1454">v</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="111,342" id="srcline342">342</a></span><span class="line">                   <span class="var type0" id="S151T0U1457">UV</span> = [<span class="var type0" id="S160T0U1460">u</span>;<span class="var type0" id="S161T0U1462">v</span>];</span></span>
<span class="srcline"><span class="lineno"><a href="111,343" id="srcline343">343</a></span><span class="line">                   <span class="keyword">if</span>( <span class="var type0" id="S159T0U1467">FH_in_U_zone</span>(<span class="var type0" id="S160T0U1468">u</span>) )</span></span>
<span class="srcline"><span class="lineno"><a href="111,344" id="srcline344">344</a></span><span class="line">                       <span class="var type0" id="S150T0U1471">tf_valid_intersection</span> = true;</span></span>
<span class="srcline"><span class="lineno"><a href="111,345" id="srcline345">345</a></span><span class="line">                   <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,346" id="srcline346">346</a></span><span class="line">        <span class="keyword">otherwise</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,347" id="srcline347">347</a></span><span class="line">            error(<span class="string">'###_ERROR:  UNknown BOX side string'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="111,348" id="srcline348">348</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,349" id="srcline349">349</a></span><span class="line"><span class="keyword">end</span> <span class="comment">%LOC_get_side_intersect_point</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,350" id="srcline350">350</a></span><span class="line"><span class="comment">%==========================================================================</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,351" id="srcline351">351</a></span><span class="line"> </span></span>
</pre>
</div>
</body>
</html>
